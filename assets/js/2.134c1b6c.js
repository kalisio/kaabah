(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{171:function(t,e,a){t.exports=a.p+"assets/img/kaabah-principle.86122ac7.svg"},172:function(t,e,a){t.exports=a.p+"assets/img/kaabah-terraform.99a18566.svg"},173:function(t,e,a){t.exports=a.p+"assets/img/kaabah-swarm.9d28a804.svg"},174:function(t,e,a){t.exports=a.p+"assets/img/bastion-architecture.26f462e8.svg"},177:function(t,e,a){"use strict";a.r(e);var r=[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"understanding-kaabah"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#understanding-kaabah","aria-hidden":"true"}},[this._v("#")]),this._v(" Understanding Kaabah")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"key-concepts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-concepts","aria-hidden":"true"}},[this._v("#")]),this._v(" Key concepts")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Kaabah")]),this._v(" let you manipulate 4 kind of entities:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("strong",[this._v("Workspace")]),this._v(": a collection of everything "),e("strong",[this._v("Kaabah")]),this._v(" needs to create and manage an infrastructure.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("strong",[this._v("Configuration")]),this._v(": a set of Terraform variables used to define your infrastructure.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("strong",[this._v("Service")]),this._v(": an application deployed on your "),e("strong",[this._v("Swarm")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:a(171),alt:"Kaabah principle"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In addition "),e("strong",[this._v("Kaabah")]),this._v(" provides a set of commands that help you to operate the cluster. For instance, you can easily prune all the images on the different nodes, execute a command on a given node... See the "),e("a",{attrs:{href:"../reference/helper-commands"}},[this._v("reference")]),this._v(" page to have the complete list.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"workspace"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#workspace","aria-hidden":"true"}},[this._v("#")]),this._v(" Workspace")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("the configuration of the infrastructure.")]),this._v(" "),e("li",[this._v("the SSH private key to get connected to the infrastructure")]),this._v(" "),e("li",[this._v("the user scripts you want to be executed when creating the infrastructure")]),this._v(" "),e("li",[this._v("the Terraform states of the infrastructure.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Starting from this premise, "),e("strong",[this._v("Kaabah")]),this._v(" lets you to manage as many clusters as your projects require. If we decide to name our workspaces with both the project name and its environment (i.e. dev, test...), we can sketch the following diagram to illustrate the overall functioning of "),e("strong",[this._v("Kaabah")]),this._v(":")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:a(172),alt:"Kaabah terraform"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("strong",[this._v("Kaabah")]),this._v(" configuration file is a "),e("strong",[this._v("Terraform")]),this._v(" variable file describing the characteristics of the desired infrastructure.")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("provider")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "AWS"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("manager_ip")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "3.115.176.41"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("manager_instance_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "t2.small"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("worker_instance_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "t3.large"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("worker_instance_count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 3")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("worker_additional_volume_count")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 2")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("worker_additional_volume_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 500")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("worker_additional_volume_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "st1"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("worker_additional_volume_mount_point")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(' "DATA"')]),t._v("\n\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("Assuming the current workspace is "),a("code",[t._v("app-dev")]),t._v(", then when applying such a configuration, "),a("strong",[t._v("Kaabah")]),t._v(" will generate a Docker Swarm infrastructure on "),a("code",[t._v("AWS")]),t._v(" ("),a("code",[t._v("provider")]),t._v(" variable) composed of:")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",[a("li",[t._v("one manager node, "),a("code",[t._v("app-dev-manager")]),t._v(", of type "),a("code",[t._v("t2.small")]),t._v(" with the public IP address "),a("code",[t._v("3.115.176.41")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("3")]),t._v(" worker nodes, "),a("code",[t._v("app-dev-worker-0")]),t._v(", "),a("code",[t._v("app-dev-worker-1")]),t._v(" and "),a("code",[t._v("app-dev-worker-2")]),t._v(", of type of "),a("code",[t._v("t3.large")]),t._v(". To each worker is attached "),a("code",[t._v("2")]),t._v(" optimized hard-disk ("),a("code",[t._v("sc1")]),t._v(") of "),a("code",[t._v("500")]),t._v("GB and these volumes are accessible through the mount points: "),a("code",[t._v("/mnt/DATA0")]),t._v(" and "),a("code",[t._v("/mnt/DATA1")]),t._v(".")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cluster","aria-hidden":"true"}},[this._v("#")]),this._v(" Cluster")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("strong",[this._v("cluster")]),this._v(" consists in of multiple Docker hosts which run in "),e("strong",[this._v("swarm")]),this._v(" mode and act as manager (to manage membership and delegation) and workers (which run services).")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:a(173),alt:"swarm concept"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"instances"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#instances","aria-hidden":"true"}},[this._v("#")]),this._v(" Instances")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("When generated from a given "),e("code",[this._v("<WORKSPACE>")]),this._v(", the instances are named according the following convention:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("code",[this._v("<WORKSPACE>-manager")])]),this._v(" "),e("li",[e("code",[this._v("<WORKSPACE>-woker-<INDEX>")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("You can add some labels to the nodes using the "),e("code",[this._v("manager_labels")]),this._v(" and "),e("code",[this._v("worker_labels")]),this._v(" variables.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),e("p",[e("strong",[this._v("Kaabah")]),this._v(" supports only x86 architecture.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"volumes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#volumes","aria-hidden":"true"}},[this._v("#")]),this._v(" Volumes")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("When needed extra disk spaces, you can attach additional volumes to the workers. These volumes are automatically attached, formatted (ext4 file system) and mounted on the workers. By default the volumes attached on a worker are accessible with the paths "),a("code",[t._v("/mnt/data0")]),t._v(", "),a("code",[t._v("mnt/data1")]),t._v(" and so on. You can override the default "),a("code",[t._v("data")]),t._v(" mount point by overriding the "),a("code",[t._v("worker_additional_volume_mount_point")]),t._v(" variable.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"network"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#network","aria-hidden":"true"}},[this._v("#")]),this._v(" Network")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"security-groups"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#security-groups","aria-hidden":"true"}},[this._v("#")]),this._v(" Security Groups")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("By default, "),e("strong",[this._v("Kaabah")]),this._v(" creates 2 security groups:")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",[a("li",[t._v("the manager security group allowing:\n"),a("ul",[a("li",[t._v("external HTTP traffic (port 80)")]),t._v(" "),a("li",[t._v("external HTTPS traffic (port 443)")]),t._v(" "),a("li",[t._v("internal SSH traffic (port 22)")]),t._v(" "),a("li",[t._v("internal Docker swarm traffic.")])])]),t._v(" "),a("li",[t._v("the workers security group with the following rules:\n"),a("ul",[a("li",[t._v("internal SSH traffic (port 22)")]),t._v(" "),a("li",[t._v("internal Docker swarm traffic")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"docker-network"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-network","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker Network")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The traffic between the nodes relies on a Docker network of type of "),e("strong",[this._v("Overlay")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The name of the Docker network is automatically computed from the workspace name but you can override it using the "),e("code",[this._v("docker_network")]),this._v(" variable.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"security"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#security","aria-hidden":"true"}},[this._v("#")]),this._v(" Security")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"ssh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssh","aria-hidden":"true"}},[this._v("#")]),this._v(" SSH")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:a(174),alt:"bastion architecture"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),e("p",[this._v("It is a best practice to harden your bastion host because it is a critical point of network security. Hardening might include disabling\nunnecessary applications or services, restrict the inbound traffic to well-known hosts.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"docker-engine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-engine","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker Engine")])}],s=a(0),n=Object(s.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("Prerequisites")]),t._v(" "),a("p",[a("strong",[t._v("Kaabah")]),t._v(" relies on various technologies such as "),a("a",{attrs:{href:"https://www.terraform.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Terraform"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Swarm"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://traefik.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Traefik"),a("OutboundLink")],1),t._v("... and we assume that you are enough familiar with them. If not, please take a while to discover them.")])]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),a("ul",[t._m(3),t._v(" "),t._m(4),t._v(" "),a("li",[a("strong",[t._v("Cluster")]),t._v(": a "),a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/key-concepts/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Swarm"),a("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(5)]),t._v(" "),a("p",[t._v("The following image illustrates how these entities interact:")]),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),a("p",[a("strong",[t._v("Kaabah")]),t._v(" is designed to take advantage of Terraform Workspaces. Indeed, "),a("strong",[t._v("Kaabah")]),t._v(" relies on the "),a("a",{attrs:{href:"https://www.terraform.io/docs/enterprise/guides/recommended-practices/part1.html#the-recommended-terraform-workspace-structure",target:"_blank",rel:"noopener noreferrer"}},[t._v("Terraform recommend practices"),a("OutboundLink")],1),t._v(" and assume a "),a("strong",[t._v("Workspace")]),t._v(" is used to store the required data needed to build and manage an infrastructure for a specific environment (staging, production...):")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),a("p",[t._v("In this diagram, the states of the different workspaces are stored within a dedicated bucket on amazon S3, but you are free to use any other Terraform "),a("a",{attrs:{href:"https://www.terraform.io/docs/backends/",target:"_blank",rel:"noopener noreferrer"}},[t._v("backends"),a("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),a("p",[t._v("Here is an example of a configuration file:")]),t._v(" "),t._m(14),t._m(15),t._v(" "),t._m(16),t._v(" "),a("p",[a("strong",[t._v("Kaabah")]),t._v(" exposes many more variables allowing you to customize in detail your infrastructure such as specifying a domain name, adding labels, running user scripts... Have a look at the complete list of "),a("router-link",{attrs:{to:"./../reference/configuration-variables.html"}},[t._v("variables")]),t._v(" and the "),a("a",{attrs:{href:"https://github.com/kalisio/kaabah/tree/master/tests",target:"_blank",rel:"noopener noreferrer"}},[t._v("tests"),a("OutboundLink")],1),t._v(" as an example.")],1),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),a("p",[a("strong",[t._v("Kaabah")]),t._v(" requires the use of a "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Bastion_host",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("Bastion")]),a("OutboundLink")],1),t._v(" to get connected to your instances.\nThe implemented solution relies on the following architecture:")]),t._v(" "),t._m(36),t._v(" "),a("p",[t._v("Your bastion instance must be instantiated in the same network of your cluster. The Security Groups rules allows the SSH traffic from the bastion.")]),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),a("p",[t._v("The Docker daemon only allows connections from clients authenticated by a certificate signed by a Certificate Authority (CA).")]),t._v(" "),a("p",[t._v("When creating the cluster, "),a("strong",[t._v("Kaabah")]),t._v(" handles the creation of the server and client keys but it requires you to provide this CA. Check out the "),a("router-link",{attrs:{to:"./getting-started.html"}},[t._v("Getting started section")]),t._v(" to learn how to generate this CA.")],1),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[a("strong",[t._v("Kaabah")]),t._v(" relies on "),a("a",{attrs:{href:"https://www.openssl.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenSSL"),a("OutboundLink")],1),t._v(" to generate the server and client keys.")])])])},r,!1,null,null,null);e.default=n.exports}}]);