<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kaabah</title>
    <meta name="description" content="A Terraform solution to build and operate Docker Swarm infrastructures">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-icon-64x64.png">
  <link rel="manifest" href="/kaabah/manifest.json">
    
    <link rel="preload" href="/kaabah/assets/css/0.styles.8280e1ab.css" as="style"><link rel="preload" href="/kaabah/assets/js/app.dd338cd8.js" as="script"><link rel="preload" href="/kaabah/assets/js/7.50d193ec.js" as="script"><link rel="prefetch" href="/kaabah/assets/js/4.6b0f67a7.js"><link rel="prefetch" href="/kaabah/assets/js/2.e69eec40.js"><link rel="prefetch" href="/kaabah/assets/js/3.aeea5ff6.js"><link rel="prefetch" href="/kaabah/assets/js/5.6a324788.js"><link rel="prefetch" href="/kaabah/assets/js/6.ad7fb63a.js"><link rel="prefetch" href="/kaabah/assets/js/8.6e412be3.js"><link rel="prefetch" href="/kaabah/assets/js/9.2bc38904.js"><link rel="prefetch" href="/kaabah/assets/js/10.c35057eb.js"><link rel="prefetch" href="/kaabah/assets/js/11.01152ee6.js"><link rel="prefetch" href="/kaabah/assets/js/12.6bb55d9a.js"><link rel="prefetch" href="/kaabah/assets/js/13.44aa4255.js">
    <link rel="stylesheet" href="/kaabah/assets/css/0.styles.8280e1ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kaabah/" class="home-link router-link-active"><!----> <span class="site-name">Kaabah</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kaabah/what-is-it/" class="nav-link">What is it ?</a></div><div class="nav-item"><a href="/kaabah/how-does-it-work/" class="nav-link router-link-exact-active router-link-active">How doest it work ?</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">How to use it ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/getting-started.html" class="nav-link">Getting started</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/advanced-usage.html" class="nav-link">Advanced usage</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/configuration-variables.html" class="nav-link">Configuration variables</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/helper-commands.html" class="nav-link">Helper commands</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/tips.html" class="nav-link">Tips</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">   ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/kaabah/CONTRIBUTING.html" class="nav-link">Contributing</a></li><li class="dropdown-item"><!----> <a href="/kaabah/LICENSE.html" class="nav-link">License</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kaabah/what-is-it/" class="nav-link">What is it ?</a></div><div class="nav-item"><a href="/kaabah/how-does-it-work/" class="nav-link router-link-exact-active router-link-active">How doest it work ?</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">How to use it ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/getting-started.html" class="nav-link">Getting started</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/advanced-usage.html" class="nav-link">Advanced usage</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/configuration-variables.html" class="nav-link">Configuration variables</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/helper-commands.html" class="nav-link">Helper commands</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/tips.html" class="nav-link">Tips</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">   ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/kaabah/CONTRIBUTING.html" class="nav-link">Contributing</a></li><li class="dropdown-item"><!----> <a href="/kaabah/LICENSE.html" class="nav-link">License</a></li></ul></div></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <i><small>Unleashing the potential of spatial information</small></i></p> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kaabah/how-does-it-work/#main-concepts" class="sidebar-link">Main concepts</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/kaabah/how-does-it-work/#workspace" class="sidebar-link">Workspace</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/kaabah/how-does-it-work/#configuration" class="sidebar-link">Configuration</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/kaabah/how-does-it-work/#cluster" class="sidebar-link">Cluster</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/how-does-it-work/#security" class="sidebar-link">Security</a></li></ul></li><li><a href="/kaabah/how-does-it-work/#service" class="sidebar-link">Service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/how-does-it-work/#traefik" class="sidebar-link">Traefik</a></li><li class="sidebar-sub-header"><a href="/kaabah/how-does-it-work/#portainer" class="sidebar-link">Portainer</a></li><li class="sidebar-sub-header"><a href="/kaabah/how-does-it-work/#prometheus" class="sidebar-link">Prometheus</a></li><li class="sidebar-sub-header"><a href="/kaabah/how-does-it-work/#grafana" class="sidebar-link">Grafana</a></li><li class="sidebar-sub-header"><a href="/kaabah/how-does-it-work/#" class="sidebar-link"></a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><div class="warning custom-block"><p class="custom-block-title">Prerequisites</p> <p><strong>Kaabah</strong> relies on various technologies such as <a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">Docker Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://portainer.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>... and we assume that you are enough familiar with them. If not, please take a while to discover them.</p></div> <h2 id="main-concepts"><a href="#main-concepts" aria-hidden="true" class="header-anchor">#</a> Main concepts</h2> <p><strong>Kaabah</strong> let you manipulate 4 kind of entities:</p> <ul><li><strong>Workspace</strong>: a collection of everything <strong>Kaabah</strong> needs to create and manage an infrastructure.</li> <li><strong>Configuration</strong>: a set of Terraform variables used to design your infrastructure.</li> <li><strong>Cluster</strong>: a Docker Swarm infrastructure built using <strong>Kaabah</strong>.</li> <li><strong>Service</strong>: an application deployed on your <strong>Cluster</strong>. By default, <strong>Kaabah</strong> comes with the following services:
<ul><li><a href="https://docs.docker.com/registry/" target="_blank" rel="noopener noreferrer">Registry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://traefik.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://portainer.io/" target="_blank" rel="noopener noreferrer">Portainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h2 id="workspace"><a href="#workspace" aria-hidden="true" class="header-anchor">#</a> Workspace</h2> <p><strong>Kaabah</strong> is designed to take advantage of Terraform Workspaces and its usage relies on the recommend practices as presented in this <a href="https://www.terraform.io/docs/enterprise/guides/recommended-practices/part1.html#the-recommended-terraform-workspace-structure" target="_blank" rel="noopener noreferrer">article<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Thus, we assume a workspace is used to store the configuration of your infrastructure for each environment.</p> <p>Starting from this premise, <strong>Kaabah</strong> lets you to manage as many clusters as your projects require. If we decide to name our workspaces with both the project name and its environment (i.e. dev, test...), we can sketch the following diagram to illustrate the overall functioning of <strong>Kaabah</strong>:</p> <p><img src="/kaabah/assets/img/kaabah-terraform.555a6e18.svg" alt="Kaabah terraform"></p> <p>In this diagram, the states of the different workspaces are stored within a dedicated bucket on amazon S3, but you are free to use any other Terraform <a href="https://www.terraform.io/docs/backends/" target="_blank" rel="noopener noreferrer">backends<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2> <p>The <strong>Kaabah</strong> configuration file is a <strong>Terraform</strong> variable file describing the characteristics of the desired infrastructure.</p> <p>Here is an example of a configuration file:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token constant">provider</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;AWS&quot;</span>

<span class="token constant">manager_ip</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;3.115.176.41&quot;</span>

<span class="token constant">manager_instance_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;t2.small&quot;</span>

<span class="token constant">worker_instance_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;t3.large&quot;</span>

<span class="token constant">worker_instance_count</span> <span class="token attr-value"><span class="token punctuation">=</span> 3</span>

<span class="token constant">worker_additional_volume_count</span> <span class="token attr-value"><span class="token punctuation">=</span> 2</span>

<span class="token constant">worker_additional_volume_size</span> <span class="token attr-value"><span class="token punctuation">=</span> 500</span>

<span class="token constant">worker_additional_volume_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;st1&quot;</span>

<span class="token constant">worker_additional_volume_mount_point</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;DATA&quot;</span>

</code></pre></div><p>Assuming the current workspace is <code>app-dev</code>, then when applying such a configuration, <strong>Kaabah</strong> will generate a Docker Swarm infrastructure on <code>AWS</code> (<code>provider</code> variable) composed of:</p> <ul><li>one manager node, <code>app-dev-manager</code>, of type <code>t2.small</code> with the public IP address <code>3.115.176.41</code>.</li> <li><code>3</code> worker nodes, <code>app-dev-worker-0</code>, <code>app-dev-worker-1</code> and <code>app-dev-worker-2</code>, of type of <code>t3.large</code>. To each worker is attached <code>2</code> optimized hard-disk (<code>sc1</code>) of <code>500</code>GB and this volume is accessible through the mount point: <code>/mnt/DATA0</code> and <code>/mnt/DATA1</code>.</li></ul> <p><strong>Kaabah</strong> exposes many more variables allowing you to customize in detail your infrastructure such as adding labels, running user scripts... Have a look at the complete list of <a href="/kaabah/how-to-use-it/configuration-variables.html">variables</a> and the <a href="https://github.com/kalisio/kaabah/tree/master/tests" target="_blank" rel="noopener noreferrer">tests<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as an example.</p> <h2 id="cluster"><a href="#cluster" aria-hidden="true" class="header-anchor">#</a> Cluster</h2> <p><b>Kaabah</b> provides the Terraform and Docker configuration to create and manage a Docker Swarm with</p> <p>The following diagram illustrates a Swarm cluster composed of 4 nodes including a <b>manager</b> and 3 <b>workers</b> and the corresponding stack of services.</p> <p><img src="/kaabah/assets/img/kaabah-swarm.d67d6932.svg" alt="swarm concept"></p> <p>The instances are named according the following convention:</p> <ul><li><code>&lt;WORKSPACE&gt;-manager</code></li> <li><code>&lt;WORKSPACE&gt;-woker-&lt;INDEX&gt;</code></li></ul> <h3 id="security"><a href="#security" aria-hidden="true" class="header-anchor">#</a> Security</h3> <p><em>TODO</em></p> <h2 id="service"><a href="#service" aria-hidden="true" class="header-anchor">#</a> Service</h2> <p>As mentioned in the introduction, <strong>Kaabah</strong> bootstraps your cluster with a stack of high level services that allows you to:</p> <ul><li>route the traffic to the cluster and ensure SSL termination using <a href="https://traefik.io/" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>manage the services deployed on the cluster using <a href="https://portainer.io/" target="_blank" rel="noopener noreferrer">Portainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>monitor the cluster using <a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>analyze the cluster metrics using <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>In addition, <strong>Kaabah</strong> lets you extend this stack to add the services of your choice. See the <a href="/kaabah/how-does-it-work/how-to-use-it/advanced-usage.html">Extending the services section</a> to learn how to do it.</p> <h3 id="traefik"><a href="#traefik" aria-hidden="true" class="header-anchor">#</a> Traefik</h3> <p><strong>traefik</strong> allows to route the traffic from internet to the Docker Swarm infrastructure with SSL termination. It uses <a href="https://letsencrypt.org/" target="_blank" rel="noopener noreferrer">Let's Encrypt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to generate and renew SSL certificates for each services.</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>Du to rate limits fixed by Let's Encrypt, it is highly recommend to set the <code>ca_server</code> variable to <code>https://acme-staging-v02.api.letsencrypt.org/directory</code> when testing your infrastructure.</p></div> <p>By default, <strong>Kaabah</strong> specializes the <strong>traefik</strong> configuration with:</p> <ul><li>2 entrypoints:
<ul><li>to allow HTTPS requests (port 443)</li> <li>to redirect HTTP (port 80) request to HTTPS (port 443)</li></ul></li> <li>5 frontends to access the services:
<ul><li><strong>traefik (dashboard)</strong></li> <li><strong>Portainer</strong></li> <li><strong>Prometheus</strong></li> <li><strong>Alertmanager</strong></li> <li><strong>Grafana</strong></li></ul></li></ul> <p>The frontend rules depend on the <code>subdomain</code> and <code>donain</code> variables defined in the Terraform configuration.</p> <p>It also support basic authentication to access the services using the variables <code>AUTH_USER</code> and <code>AUTH_PASSWORD</code>. This means that <strong>portainer</strong> and <strong>grafana</strong> authentication have been disabled.</p> <p>Considering a Terraform workspace named <code>app-dev</code>, the default subdomain will be <code>app.dev</code>and the <strong>traefik</strong> configuration will be as shown in the following diagram:</p> <p><img src="/kaabah/assets/img/kaabah-traefik.96292850.svg" alt="traefik routing"></p> <h3 id="portainer"><a href="#portainer" aria-hidden="true" class="header-anchor">#</a> Portainer</h3> <p><em>TODO</em></p> <h3 id="prometheus"><a href="#prometheus" aria-hidden="true" class="header-anchor">#</a> Prometheus</h3> <p><em>TODO</em></p> <h3 id="grafana"><a href="#grafana" aria-hidden="true" class="header-anchor">#</a> Grafana</h3> <p>By default, <strong>Grafana</strong> is shipped with the following customisation:</p> <ul><li>UI:
<ul><li>Login form disabled: indeed the access to <strong>Grafana</strong> requires to be authenticated (basic auth). This requirement is defined using Traefik frontend rule.</li> <li>The default user is granted the <code>EDITOR</code> permissions.</li></ul></li> <li>Datasources: the Prometheus datasource is included by default.</li> <li>Dashboards: 2 dashboards are provided by default:
<ul><li>Cluster overview which allow to visualize the main metrics of the cluster nodes</li> <li>Swarm overview which allow to visualize the main metrics of the Docker swarm</li></ul></li></ul> <h3 id><a href="#" aria-hidden="true" class="header-anchor">#</a></h3></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/kaabah/assets/js/7.50d193ec.js" defer></script><script src="/kaabah/assets/js/app.dd338cd8.js" defer></script>
  </body>
</html>
