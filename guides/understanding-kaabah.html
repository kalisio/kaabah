<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Understanding Kaabah | Kaabah</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kaabah/kaabah-icon-64x64.png">
    <link rel="manifest" href="/kaabah/manifest.json">
    <meta name="description" content="A Terraform solution to build and operate Docker Swarm infrastructures">
    <link rel="preload" href="/kaabah/assets/css/0.styles.b0d4fd5f.css" as="style"><link rel="preload" href="/kaabah/assets/js/app.5e9ed2c8.js" as="script"><link rel="preload" href="/kaabah/assets/js/2.9437c851.js" as="script"><link rel="preload" href="/kaabah/assets/js/3.9294698c.js" as="script"><link rel="preload" href="/kaabah/assets/js/4.cfcd4076.js" as="script"><link rel="prefetch" href="/kaabah/assets/js/10.c34ea2e3.js"><link rel="prefetch" href="/kaabah/assets/js/11.58873f73.js"><link rel="prefetch" href="/kaabah/assets/js/12.e68e72a6.js"><link rel="prefetch" href="/kaabah/assets/js/13.fb12e602.js"><link rel="prefetch" href="/kaabah/assets/js/14.16640ec9.js"><link rel="prefetch" href="/kaabah/assets/js/15.ac669eca.js"><link rel="prefetch" href="/kaabah/assets/js/16.cf916510.js"><link rel="prefetch" href="/kaabah/assets/js/17.831e69ae.js"><link rel="prefetch" href="/kaabah/assets/js/18.4925108f.js"><link rel="prefetch" href="/kaabah/assets/js/19.73a3f948.js"><link rel="prefetch" href="/kaabah/assets/js/20.9da25748.js"><link rel="prefetch" href="/kaabah/assets/js/21.7c4b4274.js"><link rel="prefetch" href="/kaabah/assets/js/5.813644f4.js"><link rel="prefetch" href="/kaabah/assets/js/6.81be51ac.js"><link rel="prefetch" href="/kaabah/assets/js/7.a364ba67.js"><link rel="prefetch" href="/kaabah/assets/js/8.3e3d8346.js"><link rel="prefetch" href="/kaabah/assets/js/9.2a2330d8.js">
    <link rel="stylesheet" href="/kaabah/assets/css/0.styles.b0d4fd5f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kaabah/" class="home-link router-link-active"><!----> <span class="site-name">Kaabah</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kaabah/about/introduction.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kaabah/guides/understanding-kaabah.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Guides
</a></div><div class="nav-item"><a href="/kaabah/reference/configuration-variables.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/kaabah/tips/" class="nav-link">
  Tips
</a></div><div class="nav-item"><a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kaabah/about/introduction.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kaabah/guides/understanding-kaabah.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Guides
</a></div><div class="nav-item"><a href="/kaabah/reference/configuration-variables.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/kaabah/tips/" class="nav-link">
  Tips
</a></div><div class="nav-item"><a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <!----></p> <ul class="sidebar-links"><li><a href="/kaabah/guides/understanding-kaabah.html" aria-current="page" class="active sidebar-link">Understanding Kaabah</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#key-concepts" class="sidebar-link">Key concepts</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#workspace" class="sidebar-link">Workspace</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#cluster" class="sidebar-link">Cluster</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#instances" class="sidebar-link">Instances</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#volumes" class="sidebar-link">Volumes</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#network" class="sidebar-link">Network</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#security" class="sidebar-link">Security</a></li></ul></li></ul></li><li><a href="/kaabah/guides/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/kaabah/guides/advanced-usage.html" class="sidebar-link">Advanced usage</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="understanding-kaabah"><a href="#understanding-kaabah" class="header-anchor">#</a> Understanding Kaabah</h1> <div class="custom-block warning"><p class="custom-block-title">Prerequisites</p> <p><strong>Kaabah</strong> relies on various technologies such as <a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">Docker Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://traefik.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>... and we assume that you are enough familiar with them. If not, please take a while to discover them.</p></div> <h2 id="key-concepts"><a href="#key-concepts" class="header-anchor">#</a> Key concepts</h2> <p><strong>Kaabah</strong> let you manipulate 4 kind of entities:</p> <ul><li><strong>Workspace</strong>: a collection of everything <strong>Kaabah</strong> needs to create and manage an infrastructure.</li> <li><strong>Configuration</strong>: a set of Terraform variables used to define your infrastructure.</li> <li><strong>Cluster</strong>: a <a href="https://docs.docker.com/engine/swarm/key-concepts/" target="_blank" rel="noopener noreferrer">Docker Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> infrastructure.</li></ul> <p>The following image illustrates how these entities interact:</p> <p><img src="/kaabah/assets/img/kaabah-principle.cca0399c.svg" alt="Kaabah principle"></p> <p>In addition <strong>Kaabah</strong> provides a set of commands that help you to operate the cluster. For instance, you can easily prune all the images on the different nodes, execute a command on a given node... See the <a href="../reference/helper-commands">reference</a> page to have the complete list.</p> <h2 id="workspace"><a href="#workspace" class="header-anchor">#</a> Workspace</h2> <p><strong>Kaabah</strong> is designed to take advantage of Terraform Workspaces. Indeed, <strong>Kaabah</strong> relies on the <a href="https://www.terraform.io/docs/enterprise/guides/recommended-practices/part1.html#the-recommended-terraform-workspace-structure" target="_blank" rel="noopener noreferrer">Terraform recommend practices<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and assume a <strong>Workspace</strong> is used to store the required data needed to build and manage an infrastructure for a specific environment (staging, production...):</p> <ul><li>the configuration of the infrastructure.</li> <li>the SSH private key to get connected to the infrastructure</li> <li>the user scripts you want to be executed when creating the infrastructure</li> <li>the Terraform states of the infrastructure.</li></ul> <p>Starting from this premise, <strong>Kaabah</strong> lets you to manage as many clusters as your projects require. If we decide to name our workspaces with both the project name and its environment (i.e. dev, test...), we can sketch the following diagram to illustrate the overall functioning of <strong>Kaabah</strong>:</p> <p><img src="/kaabah/assets/img/kaabah-terraform.2b43f23c.svg" alt="Kaabah terraform"></p> <p>In this diagram, the states of the different workspaces are stored within a dedicated bucket on amazon S3, but you are free to use any other Terraform <a href="https://www.terraform.io/docs/backends/" target="_blank" rel="noopener noreferrer">backends<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <p>The <strong>Kaabah</strong> configuration file is a <strong>Terraform</strong> variable file describing the characteristics of the desired infrastructure.</p> <p>Here is an example of a configuration file:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token constant">cloud_provider</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;AWS&quot;</span>

<span class="token constant">manager_instance_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;t2.small&quot;</span>

<span class="token constant">manager_ips</span> <span class="token attr-value"><span class="token punctuation">=</span> [&quot;3.115.176.41&quot;]</span>

<span class="token constant">worker_instance_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;t3.large&quot;</span>

<span class="token constant">worker_instance_count</span> <span class="token attr-value"><span class="token punctuation">=</span> 3</span>

<span class="token constant">worker_additional_volume_size</span> <span class="token attr-value"><span class="token punctuation">=</span> 500</span>

<span class="token constant">worker_additional_volume_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;st1&quot;</span>

<span class="token constant">worker_additional_volume_mount_point</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;/mnt/data&quot;</span>

</code></pre></div><p>Assuming the current workspace is <code>app-dev</code>, then when applying such a configuration, <strong>Kaabah</strong> will generate a Docker Swarm infrastructure on <code>AWS</code> (<code>cloud_provider</code> variable) composed of:</p> <ul><li><code>1</code> manager node, <code>app-dev-manager</code>, of type <code>t2.small</code> with the public IP address <code>3.115.176.41</code>.</li> <li><code>3</code> worker nodes, <code>app-dev-worker-0</code>, <code>app-dev-worker-1</code> and <code>app-dev-worker-2</code>, of type of <code>t3.large</code>. To each worker is attached <code>2</code> optimized hard-disk (<code>sc1</code>) of <code>500</code>GB and these volumes are accessible through the mount points: <code>/mnt/data0</code> and <code>/mnt/data1</code>.</li></ul> <p><strong>Kaabah</strong> exposes many more variables allowing you to customize in detail your infrastructure. Have a look at the complete list of <a href="/kaabah/reference/configuration-variables.html">variables</a> and the <a href="https://github.com/kalisio/kaabah/tree/master/tests" target="_blank" rel="noopener noreferrer">tests<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as examples.</p> <h2 id="cluster"><a href="#cluster" class="header-anchor">#</a> Cluster</h2> <p>The <strong>cluster</strong> consists in of multiple Docker hosts which run in <strong>swarm</strong> mode and act as <strong>Manager</strong>, to manage membership and delegation, and as <strong>Workers</strong> which run the services.</p> <p><img src="/kaabah/assets/img/kaabah-swarm.bd36259a.svg" alt="swarm concept"></p> <p><strong>Kaabah</strong> let you build any kind of cluster topologies: 1 to many managers, 0 to many workers.</p> <p><img src="/kaabah/assets/img/kaabah-topologies.0e3d60e1.svg" alt="swarm topologies"></p> <h3 id="instances"><a href="#instances" class="header-anchor">#</a> Instances</h3> <h4 id="instance-types"><a href="#instance-types" class="header-anchor">#</a> Instance types</h4> <p><strong>Kaabah</strong> let you provide a same instance types for each managers and another instance type for each workers.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><strong>Kaabah</strong> supports only x86 architecture.</p></div> <h4 id="naming-convention"><a href="#naming-convention" class="header-anchor">#</a> Naming convention</h4> <p>Each created instances are named according the following convention:</p> <ul><li><code>&lt;WORKSPACE&gt;-manager-&lt;INDEX&gt;</code></li> <li><code>&lt;WORKSPACE&gt;-woker-&lt;INDEX&gt;</code></li></ul> <p>where <code>&lt;WORKSPACE&gt;</code> specify the name of the <strong>Terraform</strong> workspace.</p> <h4 id="operating-system"><a href="#operating-system" class="header-anchor">#</a> Operating system</h4> <p>All the instances are created using the <strong>Ubuntu 20.04 TLS</strong> image provided by <strong>AWS</strong>, <strong>OVH</strong> and <strong>Scaleway</strong>.</p> <h4 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h4> <p><strong>Kaabah</strong> installs the version <code>19.03.12</code> of <strong>Docker</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can override the version using the <a href="/kaabah/reference/configuration-variables.html#docker"><code>docker_version</code></a></p></div> <h3 id="volumes"><a href="#volumes" class="header-anchor">#</a> Volumes</h3> <h4 id="gluster-shared-volume"><a href="#gluster-shared-volume" class="header-anchor">#</a> Gluster Shared volume</h4> <p>When creating the cluster, <strong>Kaabah</strong> creates a shared volume among the nodes using <a href="https://www.gluster.org/" target="_blank" rel="noopener noreferrer">Gluster<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><img src="/kaabah/assets/img/kaabah-gluster.d015860b.svg" alt="gluster concept"></p> <p>If your cluster is composed of 1 manager only, the shared volume is created in <code>distributed</code> mode, otherwise the shared volume is created in <code>replicated</code> mode to enhance the resilience. Check the <a href="https://docs.gluster.org/en/latest/Administrator%20Guide/Setting%20Up%20Volumes/#creating-distributed-volumes" target="_blank" rel="noopener noreferrer">documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to learn more about these modes.</p> <p>By default, the <strong>Gluster</strong> volume is mounted using the default mount point <code>/mnt/share</code>. It can be overridden by setting the variable <code>gluster_share_volume_mount_point</code>.</p> <h4 id="additional-block-volumes"><a href="#additional-block-volumes" class="header-anchor">#</a> Additional block volumes</h4> <p>When needed extra disk spaces, you can attach an additional volume either on the managers, either on the workers or both.</p> <p><img src="/kaabah/assets/img/kaabah-volumes.707343a6.svg" alt="additional volumes"></p> <p>These volumes are automatically attached, formatted to <a href="https://en.wikipedia.org/wiki/Ext4" target="_blank" rel="noopener noreferrer">EXT4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and mounted on the nodes. By default the volumes are accessible through the mount point <code>/mnt/data</code>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can override this default mount point by overriding the <code>manager_additional_volume_mount_point</code> and <code>worker_additional_volume_mount_point</code> variables.</p></div> <h3 id="network"><a href="#network" class="header-anchor">#</a> Network</h3> <h4 id="ip-addresses"><a href="#ip-addresses" class="header-anchor">#</a> IP addresses</h4> <p><strong>Kaabah</strong> let you define the IP addresses of the managers nodes. The IP addresses you can assign to the managers are given (usually bought) by your provider:</p> <ul><li>on <strong>AWS</strong> it must be an <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" target="_blank" rel="noopener noreferrer">Elastic IP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>on <strong>Scaleway</strong> it must be a <a href="https://www.scaleway.com/en/faq/servers/network/#-What-is-a-flexible-IP-address" target="_blank" rel="noopener noreferrer">Flexible IP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>on <strong>OVH</strong> it must be a <a href="https://www.ovhcloud.com/en/bare-metal/ip/" target="_blank" rel="noopener noreferrer">Floating IP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>::: Warning
On <strong>OVH</strong>, even if <strong>Kaabahh</strong> adds automatically a network interface to allow the binding of the <strong>Floating IP</strong> to this instance, you need to do manually this binding using the <strong>OVH</strong> interface.
:::</p> <h4 id="security-groups"><a href="#security-groups" class="header-anchor">#</a> Security Groups</h4> <p>By default, <strong>Kaabah</strong> creates 2 security groups:</p> <ul><li>a security group assigned to the managers with the following rules:
<ul><li>external HTTP traffic (port 80)</li> <li>external HTTPS traffic (port 443)</li> <li>internal SSH traffic (port 22)</li> <li>internal Docker swarm traffic</li> <li>internal Gluster traffic</li></ul></li> <li>a security group assigned to the workers with the following rules:
<ul><li>internal SSH traffic (port 22)</li> <li>internal Docker swarm traffic</li> <li>internal Gluster traffic</li></ul></li></ul> <h3 id="security"><a href="#security" class="header-anchor">#</a> Security</h3> <h4 id="ssh"><a href="#ssh" class="header-anchor">#</a> SSH</h4> <p><strong>Kaabah</strong> requires the use of a <a href="https://en.wikipedia.org/wiki/Bastion_host" target="_blank" rel="noopener noreferrer"><strong>Bastion</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to get connected to your instances.
The implemented solution relies on the following architecture:</p> <p><img src="/kaabah/assets/img/kaabah-bastion.02afd837.svg" alt="bastion architecture"></p> <p>Your bastion instance must be instantiated in the same network of your cluster. The Security Groups rules allows the SSH traffic from the bastion.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>It is a best practice to harden your bastion host because it is a critical point of network security. Hardening might include disabling
unnecessary applications or services, restrict the inbound traffic to well-known hosts.</p></div> <h4 id="docker-engine"><a href="#docker-engine" class="header-anchor">#</a> Docker Engine</h4> <p>The Docker daemon only allows connections from clients authenticated by a certificate signed by a Certificate Authority (CA).</p> <p>When creating the cluster, <strong>Kaabah</strong> handles the creation of the server and client keys but it requires you to provide this CA. Check out the <a href="/kaabah/guides/getting-started.html">Getting started section</a> to learn how to generate this CA.</p> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p><strong>Kaabah</strong> relies on <a href="https://www.openssl.org/" target="_blank" rel="noopener noreferrer">OpenSSL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to generate the server and client keys.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/kaabah/guides/getting-started.html">
        Getting started
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/kaabah/assets/js/app.5e9ed2c8.js" defer></script><script src="/kaabah/assets/js/2.9437c851.js" defer></script><script src="/kaabah/assets/js/3.9294698c.js" defer></script><script src="/kaabah/assets/js/4.cfcd4076.js" defer></script>
  </body>
</html>
