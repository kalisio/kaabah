<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting started | Kaabah</title>
    <meta name="description" content="A Terraform solution to build and operate Docker Swarm infrastructures">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kaabah/kaabah-icon-64x64.png">
  <link rel="manifest" href="/kaabah/manifest.json">
    
    <link rel="preload" href="/kaabah/assets/css/0.styles.5f60cd56.css" as="style"><link rel="preload" href="/kaabah/assets/js/app.a3f590c4.js" as="script"><link rel="preload" href="/kaabah/assets/js/11.05559eab.js" as="script"><link rel="prefetch" href="/kaabah/assets/js/10.01d059c1.js"><link rel="prefetch" href="/kaabah/assets/js/12.4593cc57.js"><link rel="prefetch" href="/kaabah/assets/js/13.48230c81.js"><link rel="prefetch" href="/kaabah/assets/js/14.8684b11a.js"><link rel="prefetch" href="/kaabah/assets/js/15.202a4118.js"><link rel="prefetch" href="/kaabah/assets/js/2.b096953a.js"><link rel="prefetch" href="/kaabah/assets/js/3.9de83eee.js"><link rel="prefetch" href="/kaabah/assets/js/4.f68da44a.js"><link rel="prefetch" href="/kaabah/assets/js/5.fec3354f.js"><link rel="prefetch" href="/kaabah/assets/js/6.81fa74fa.js"><link rel="prefetch" href="/kaabah/assets/js/7.c23c8004.js"><link rel="prefetch" href="/kaabah/assets/js/8.8d4ab15e.js"><link rel="prefetch" href="/kaabah/assets/js/9.6455eb2a.js">
    <link rel="stylesheet" href="/kaabah/assets/css/0.styles.5f60cd56.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kaabah/" class="home-link router-link-active"><!----> <span class="site-name">Kaabah</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kaabah/about/introduction.html" class="nav-link">About</a></div><div class="nav-item"><a href="/kaabah/guides/understanding-kaabah.html" class="nav-link">Guides</a></div><div class="nav-item"><a href="/kaabah/reference/configuration-variables.html" class="nav-link">Reference</a></div><div class="nav-item"><a href="/kaabah/tips/" class="nav-link">Tips</a></div><div class="nav-item"><a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kaabah/about/introduction.html" class="nav-link">About</a></div><div class="nav-item"><a href="/kaabah/guides/understanding-kaabah.html" class="nav-link">Guides</a></div><div class="nav-item"><a href="/kaabah/reference/configuration-variables.html" class="nav-link">Reference</a></div><div class="nav-item"><a href="/kaabah/tips/" class="nav-link">Tips</a></div><div class="nav-item"><a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <i><small>Unleashing the potential of spatial information</small></i></p> <ul class="sidebar-links"><li><a href="/kaabah/guides/understanding-kaabah.html" class="sidebar-link">Understanding Kaabah</a></li><li><a href="/kaabah/guides/getting-started.html" class="active sidebar-link">Getting started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#prerequisites" class="sidebar-link">Prerequisites</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#terraform" class="sidebar-link">Terraform</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#providers" class="sidebar-link">Providers</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#docker-tls-certificate-authority" class="sidebar-link">Docker TLS Certificate Authority</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#terraform-backend" class="sidebar-link">Terraform backend</a></li></ul></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#installation" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#clone-the-github-repository" class="sidebar-link">Clone the Github repository</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#setup-your-terraform-environment" class="sidebar-link">Setup your Terraform environment</a></li></ul></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#usage" class="sidebar-link">Usage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#create-a-workspace" class="sidebar-link">Create a workspace</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#configure-the-workspace" class="sidebar-link">Configure the workspace</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#apply-the-changes" class="sidebar-link">Apply the changes</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#check-the-infrastructure" class="sidebar-link">Check the infrastructure</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/getting-started.html#destroy-the-infrastructure" class="sidebar-link">Destroy the infrastructure</a></li></ul></li></ul></li><li><a href="/kaabah/guides/advanced-usage.html" class="sidebar-link">Advanced usage</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="getting-started"><a href="#getting-started" aria-hidden="true" class="header-anchor">#</a> Getting started</h1> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p><strong>Kaabah</strong> relies on various technologies such as <a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">Docker Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://traefik.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>... and we assume that you are enough familiar with them. If not, please take a while to discover them.</p></div> <h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true" class="header-anchor">#</a> Prerequisites</h2> <h3 id="terraform"><a href="#terraform" aria-hidden="true" class="header-anchor">#</a> Terraform</h3> <p>You must have <strong>Terraform</strong> installed on your computer. For now <strong>Kaabah</strong> requires the <code>0.11.12</code> version of Terraform. Please refer to the <a href="https://learn.hashicorp.com/terraform/getting-started/install.html" target="_blank" rel="noopener noreferrer">official guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to install <strong>Terraform</strong>.</p> <h3 id="providers"><a href="#providers" aria-hidden="true" class="header-anchor">#</a> Providers</h3> <h4 id="account-authentication"><a href="#account-authentication" aria-hidden="true" class="header-anchor">#</a> Account authentication</h4> <p>To enable <strong>Terraform</strong> to exploit the providers APIs, you must have created an account on the various providers and be aware of your credentials to access the APIs.</p> <h4 id="instances-authentication"><a href="#instances-authentication" aria-hidden="true" class="header-anchor">#</a> Instances authentication</h4> <p>When running <strong>Kaabah</strong> and to get connected to your instances, you must be aware of the private SSH keys to access the instances. These keys are generally created using the providers functionalities.</p> <p>In addition, <strong>Kaabah</strong> makes the assumption you already have a <a href="https://en.wikipedia.org/wiki/Bastion_host" target="_blank" rel="noopener noreferrer"><strong>Bastion</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> installed for each providers. You must provide the information to access the bastions:</p> <ul><li>the public IP</li> <li>the SSH private key</li> <li>the SSH user</li></ul> <h4 id="network"><a href="#network" aria-hidden="true" class="header-anchor">#</a> Network</h4> <p>Because each of the cloud providers do not offer the same solutions regarding the network, there are some specificities to take into account. Mainly, to use the <strong>OVH</strong> module, it is necessary beforehand to create a private network named <strong>Private-Net</strong> and a subnet named <strong>Private-Subnet</strong>. In the other hand, you can assign to the subnet the <strong>CIDR</strong> of your choice, <strong>Kaabah</strong> will retrieve it.</p> <h3 id="docker-tls-certificate-authority"><a href="#docker-tls-certificate-authority" aria-hidden="true" class="header-anchor">#</a> Docker TLS Certificate Authority</h3> <p><strong>Kaabah</strong> ensures TLS authentication for Docker daemon and requires a Certificate Authority (CA). The following files are required to run <strong>Kaabah</strong>:</p> <ul><li>the CA private key: <code>ca.key</code></li> <li>the CA public key: <code>ca.cert</code></li> <li>the CA passphrase file: <code>ca.pass</code></li></ul> <p>You can use the following <a href="https://gist.github.com/cnouguier/c5cb4ba99ad45bced4476e2d175342a1" target="_blank" rel="noopener noreferrer">script<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to create these files.</p> <h3 id="terraform-backend"><a href="#terraform-backend" aria-hidden="true" class="header-anchor">#</a> Terraform backend</h3> <p>You must have the credentials set to access the desired bucket on AWS S3 otherwise <strong>Terraform</strong> won't initialize.
If needed, follow this <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/setup-credentials.html" target="_blank" rel="noopener noreferrer">guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to set up your credentials.</p> <h2 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h2> <h3 id="clone-the-github-repository"><a href="#clone-the-github-repository" aria-hidden="true" class="header-anchor">#</a> Clone the Github repository</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone https://github.com/kalisio/kaabah.git
$ <span class="token function">cd</span> kaabah
</code></pre></div><h3 id="setup-your-terraform-environment"><a href="#setup-your-terraform-environment" aria-hidden="true" class="header-anchor">#</a> Setup your Terraform environment</h3> <div class="warning custom-block"><p class="custom-block-title">Security</p> <p>Hard-coding credentials into any <strong>Terraform</strong> configuration is not recommended, and risks secret leakage should this file ever be committed to a public version control system.
We strongly recommend to store the credentials using environment variables.</p></div> <ol><li>Define your <strong>Scaleway</strong> credentials</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$export</span> TF_VAR_SCALEWAY_ORGANIZATION<span class="token operator">=</span><span class="token string">&quot;&lt;ORGANIZATION-ID&gt;&quot;</span>
<span class="token variable">$export</span> TF_VAR_SCALEWAY_TOKEN<span class="token operator">=</span><span class="token string">&quot;&lt;ACCESS-TOKEN&gt;&quot;</span> 
</code></pre></div><ol start="2"><li>Define your <strong>AWS</strong> credentials</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$export</span> TF_VAR_AWS_ACCESS_KEY<span class="token operator">=</span><span class="token string">&quot;&lt;ACCESS-KEY&gt;&quot;</span>
<span class="token variable">$export</span> TF_VAR_AWS_SECRET_KEY<span class="token operator">=</span><span class="token string">&quot;&lt;SECRET-KEY&gt;&quot;</span> 
</code></pre></div><ol start="3"><li>Define your <strong>OVH</strong> credentials</li></ol> <p>The <strong>OVH</strong> module relies on the <a href="https://www.terraform.io/docs/providers/openstack/" target="_blank" rel="noopener noreferrer">OpenStack provider<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, thus you need to provide the
<strong>OpenStack</strong> credentials only:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">export</span> OS_AUTH_URL<span class="token operator">=</span><span class="token string">&quot;https://auth.cloud.ovh.net/v3&quot;</span> // authentication URL
<span class="token function">export</span> OS_TENANT_ID<span class="token operator">=</span><span class="token string">&quot;&lt;TENANT-ID&gt;&quot;</span> <span class="token comment"># Horizon project ID</span>
<span class="token function">export</span> OS_TENANT_NAME<span class="token operator">=</span><span class="token string">&quot;&lt;TENANT-NAME&gt;&quot;</span> <span class="token comment"># Horizon project name</span>
<span class="token function">export</span> OS_USERNAME<span class="token operator">=</span><span class="token string">&quot;&lt;USERNAME&gt;&quot;</span> <span class="token comment"># Horizon username</span>
<span class="token function">export</span> OS_PASSWORD<span class="token operator">=</span><span class="token string">&quot;&lt;PASSWORD&gt;&quot;</span> <span class="token comment"># Horizon password</span>
</code></pre></div><ol start="4"><li>Define your bastions configuration</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$TF_VAR_bastion_ips</span> <span class="token operator">=</span> <span class="token string">'{ AWS = &quot;X.X.X.X&quot;, SCW = &quot;Y.Y.Y.Y&quot;, OVH = &quot;Z.Z.Z.Z&quot; }'</span>
<span class="token variable">$TF_VAR_bastion_ssh_keys</span> <span class="token operator">=</span> <span class="token string">'{ AWS = &quot;aws.pem&quot;, SCW = &quot;scw.pem&quot;, OVH = &quot;ovh.pem&quot; }'</span>
<span class="token variable">$TF_VAR_bastion_ssh_users</span> <span class="token operator">=</span> <span class="token string">'{ AWS = &quot;user&quot;, SCW = &quot;user&quot;, OVH = &quot;user&quot; }'</span>
</code></pre></div><ol start="5"><li>Define the <a href="https://www.terraform.io/docs/backends/types/s3.html" target="_blank" rel="noopener noreferrer">S3 backend<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> properties</li></ol> <p>Create a file <code>backend.config</code> with the following properties:</p> <div class="language- extra-class"><pre class="language-text"><code>bucket = &quot;the name of the bucket&quot;
region = &quot;the region of the bucket&quot;
key    = &quot;the key to the states&quot;
</code></pre></div><ol start="6"><li>Initialize Terraform</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$terraform</span> init -backend-config<span class="token operator">=</span><span class="token string">&quot;path/to/your/backend.config&quot;</span>
</code></pre></div><h2 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> Usage</h2> <div class="warning custom-block"><p class="custom-block-title">ACME certificates</p> <p>To ensure ACME certificates generation, <strong>traefik</strong> has to be reachable by <strong>Let's Encrypt</strong> through port 80. You can refer to <a href="https://docs.traefik.io/configuration/acme/#httpchallenge" target="_blank" rel="noopener noreferrer">ACME configuration (httpChallenge)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for further information.</p> <p>Please take care your DNS is correctly configured. A <strong>A Record</strong> should map your domain to the Swarm manager IP address.</p></div> <h3 id="create-a-workspace"><a href="#create-a-workspace" aria-hidden="true" class="header-anchor">#</a> Create a workspace</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$terraform</span> workspace new demo
</code></pre></div><p>Terraform will automatically switch to the created workspace <code>demo</code></p> <h3 id="configure-the-workspace"><a href="#configure-the-workspace" aria-hidden="true" class="header-anchor">#</a> Configure the workspace</h3> <p>We recommend to create a <code>tfvars</code> file to override the default variables for your workspace. For instance, the <code>demo.tfvars</code> file may look like this:</p> <div class="language-text extra-class"><pre class="language-text"><code>provider = &quot;AWS&quot;

region = &quot;eu-central-1&quot;

domain = &quot;kalisio.xyz&quot;

ca_server = &quot;https://acme-staging-v02.api.letsencrypt.org/directory&quot;

#acme_file = &quot;tests/acme.json&quot;

auth_user = &quot;admin&quot;

auth_password = &quot;$apr1$5.zwyoj.$IBdA2H8cHHQtLPzm/9veL/&quot;

ssh_key = &quot;../workspaces/master/test-aws.pem&quot;

key_name = &quot;test-aws&quot;

manager_instance_type = &quot;t2.small&quot;

manager_crontab = &quot;tests/crontab&quot;

manager_user_script = &quot;tests/manager.sh&quot;

worker_instance_type = &quot;t3.large&quot;

worker_instance_count = 2

worker_additional_volume_count = 1

worker_additional_volume_size = 500

worker_additional_volume_type = &quot;sc1&quot;

worker_additional_volume_mount_point = &quot;data&quot;

worker_labels=[&quot;worker0=true apps=true&quot;, &quot;worker1=true dbs=true&quot;]

worker_user_scripts=[&quot;tests/worker.sh&quot;, &quot;tests/worker.sh&quot;]

extensions_dir = &quot;tests/extensions&quot;
</code></pre></div><h3 id="apply-the-changes"><a href="#apply-the-changes" aria-hidden="true" class="header-anchor">#</a> Apply the changes</h3> <p>Within your workspace, apply Terraform with your specific configuration:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$terraform</span> apply -var-file<span class="token operator">=</span><span class="token string">&quot;path/to/your/config.tfvars&quot;</span>
</code></pre></div><p>After a while, your cluster should be created and the corresponding Terraform states stored in your S3 backend.</p> <h3 id="check-the-infrastructure"><a href="#check-the-infrastructure" aria-hidden="true" class="header-anchor">#</a> Check the infrastructure</h3> <p>Get connected to the manager of your infrastructure using <code>ssh</code> and type the following commands:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ubuntu@test-aws-manager:~$ k-swarm-info

Nodes <span class="token operator">&gt;</span>-----

ID                              HOSTNAME                STATUS          ADDRESS         LABELS
4ylkfx3vis3zlxqwvs7rcms0p       test-aws-manager        Ready/Active    172.31.25.252
svpnq8a71v90hu7ir6ng7335d       test-aws-worker-0       Ready/Active    172.31.21.238   apps<span class="token operator">=</span>true worker0<span class="token operator">=</span>true
jwgud49dpjvxfdkgnfa1we9la       test-aws-worker-1       Ready/Active    172.31.19.239   dbs<span class="token operator">=</span>true worker1<span class="token operator">=</span>true

Stacks <span class="token operator">&gt;</span>------

NAME            SERVICES
kaabah          8

Services <span class="token operator">&gt;</span>------

ID                  NAME                   MODE                REPLICAS            IMAGE                        PORTS
imt4640a55sa        kaabah_alertmanager    replicated          1/1                 prom/alertmanager:v0.17.0
2dk1t5jaeleq        kaabah_cadvisor        global              3/3                 google/cadvisor:v0.33.0
3moom2hbx8o7        kaabah_grafana         replicated          1/1                 grafana/grafana:6.1.6
s1m29d7c51zw        kaabah_node-exporter   global              3/3                 prom/node-exporter:v0.17.0
y1zm0h699q60        kaabah_prometheus      replicated          1/1                 prom/prometheus:v2.9.2
1fwm7sexsz4k        kaabah_pushgateway     replicated          1/1                 prom/pushgateway:v0.8.0
wa262dqh51qt        kaabah_registry        replicated          1/1                 registry:2                   *:5000-<span class="token operator">&gt;</span>5000/tcp
a8xhmu9k7jbq        kaabah_traefik         replicated          1/1                 traefik:1.7-alpine

Containers <span class="token operator">&gt;</span>-----


test-aws-manager
ID              NAMES   STATUS
0eb9d385fc74    kaabah_grafana.1.u42yijzrl7vhubfb4ufup4hgq      Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
7c8ad92974d4    kaabah_cadvisor.4ylkfx3vis3zlxqwvs7rcms0p.0bcnfte5qsr4zxvim4dvapywg     Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
e26ab0a9a84a    kaabah_traefik.1.kn2pnp5wm9s2kqsm7x7ukl0gt      Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
a401aba300b1    kaabah_alertmanager.1.n424mme5cpqh1gbyqtwvn1cfi Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
bf10a39ce027    kaabah_prometheus.1.tzoe5g0rfnodzq84h73elavoa   Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
3b5aeb22291a    kaabah_registry.1.41f8l2p5fh2kam5qx2mj8a2rk     Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
b97a12b43694    kaabah_pushgateway.1.rbrtvtz3xcjy6uda7w6d3wdbz  Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
7cb96b612380    kaabah_node-exporter.4ylkfx3vis3zlxqwvs7rcms0p.ftmk23sinf18w5zhzp5fhg5yj        Up About an hour

test-aws-worker-0
ID              NAMES   STATUS
0c483b70fedd    kaabah_cadvisor.svpnq8a71v90hu7ir6ng7335d.kfloir1m5cv012ogb5ck7wnhh     Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
b3e1a4117807    kaabah_node-exporter.svpnq8a71v90hu7ir6ng7335d.4n71fp7vpvi7z0avzpkriuypv        Up About an hour

test-aws-worker-1
ID              NAMES   STATUS
0168740c5c45    kaabah_cadvisor.jwgud49dpjvxfdkgnfa1we9la.qj55xvd5ugood47e7wz35mbgn     Up About an hour <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>
420e5b27bccb    kaabah_node-exporter.jwgud49dpjvxfdkgnfa1we9la.ihi62eehuwna6a1qxzjt9lx2g        Up About an hour
ubuntu@test-aws-manager:~$
</code></pre></div><h3 id="destroy-the-infrastructure"><a href="#destroy-the-infrastructure" aria-hidden="true" class="header-anchor">#</a> Destroy the infrastructure</h3> <p>To destroy the created infrastructure, you can simply type the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$terraform</span> apply -var-file<span class="token operator">=</span><span class="token string">&quot;path/to/your/config.tfvars&quot;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kaabah/guides/understanding-kaabah.html" class="prev">
          Understanding Kaabah
        </a></span> <span class="next"><a href="/kaabah/guides/advanced-usage.html">
          Advanced usage
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/kaabah/assets/js/app.a3f590c4.js" defer></script><script src="/kaabah/assets/js/11.05559eab.js" defer></script>
  </body>
</html>
