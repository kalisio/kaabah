(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{179:function(t,e,a){"use strict";a.r(e);var r=a(0),s=Object(r.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[a("strong",[t._v("Kaabah")]),t._v(" relies on various technologies such as "),a("a",{attrs:{href:"https://www.terraform.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Terraform"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Swarm"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://portainer.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Traefik"),a("OutboundLink")],1),t._v("... and we assume that you are enough familiar with them. If not, please take a while to discover them.")])]),t._v(" "),t._m(1),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("Certificate Authority")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("You can use the following "),a("a",{attrs:{href:"https://gist.github.com/cnouguier/c5cb4ba99ad45bced4476e2d175342a1",target:"_blank",rel:"noopener noreferrer"}},[t._v("script"),a("OutboundLink")],1),t._v(" to create the required files.")])]),t._v(" "),t._m(4),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("AWS S3 Credentials")]),t._v(" "),a("p",[t._v("You must have the credentials set to access the desired bucket on AWS S3 otherwise "),a("strong",[t._v("Terraform")]),t._v(" won't initialize.\nIf needed, follow this "),a("a",{attrs:{href:"https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/setup-credentials.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("guide"),a("OutboundLink")],1),t._v(" to set up your credentials.")])]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),a("ol",[a("li",[t._v("Define the "),a("a",{attrs:{href:"https://www.terraform.io/docs/backends/types/s3.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("S3 backend"),a("OutboundLink")],1),t._v(" properties")])]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("Manager IP address")]),t._v(" "),a("p",[a("strong",[t._v("Kaabah")]),t._v(" requests the IP address of the Swarm manager to be defined. On "),a("strong",[t._v("Scaleway")]),t._v(" you need to provide a "),a("a",{attrs:{href:"https://www.scaleway.com/docs/deal-with-private-reserved-ips/#-Create-and-attach-a-reserved-IP-address",target:"_blank",rel:"noopener noreferrer"}},[t._v("Reserved IP"),a("OutboundLink")],1),t._v(". On "),a("strong",[t._v("AWS")]),t._v(" you need to provide an "),a("a",{attrs:{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Elastic IP"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("ACME certificates")]),t._v(" "),a("p",[t._v("To ensure ACME certificates generation, "),a("strong",[t._v("traefik")]),t._v(" has to be reachable by "),a("strong",[t._v("Let's Encrypt")]),t._v(" through port 80. You can refer to "),a("a",{attrs:{href:"https://docs.traefik.io/configuration/acme/#httpchallenge",target:"_blank",rel:"noopener noreferrer"}},[t._v("ACME configuration (httpChallenge)"),a("OutboundLink")],1),t._v(" for further information.")]),t._v(" "),t._m(18)]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("In that case, the manager will act as a "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Bastion_host",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("Bastion")]),a("OutboundLink")],1),t._v(". That is to say, you will have to use the\nmanager as an SSH Gateway to get connected to the workers. If you have an existing "),a("strong",[t._v("Bastion")]),t._v(" lying in the same VPC, you can take configure your cluster to use it in order to secure the access.\nFor more information see the "),a("router-link",{attrs:{to:"./advanced-usage.html#using-a-bastion"}},[t._v("Using a bastion")]),t._v(" documentation.")],1)]),t._v(" "),t._m(25),t._v(" "),a("p",[t._v("Within your workspace, apply Terraform with your specific configuration:")]),t._v(" "),t._m(26),a("p",[t._v("After a while, your cluster should be created and the corresponding Terraform states stored in your S3 backend.")]),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._m(30),t._m(31),t._v(" "),a("p",[t._v("To destroy the created infrastructure, you can simply type the following command:")]),t._v(" "),t._m(32)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"getting-started"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getting-started","aria-hidden":"true"}},[this._v("#")]),this._v(" Getting started")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"prerequisites"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[this._v("#")]),this._v(" Prerequisites")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Kaabah")]),this._v(" ensures TLS authentication for Docker daemon and requires a Certificate Authority (CA). More precisely, to use "),e("strong",[this._v("Kaabah")]),this._v(", you need the following files:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("the CA private key")]),this._v(" "),e("li",[this._v("the CA public key")]),this._v(" "),e("li",[this._v("the CA passphrase file")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[this._v("SSH key")]),this._v(" "),e("p",[e("strong",[this._v("Kaabah")]),this._v(" uses SSH to operate on the various nodes and consequently you need the private key to connect to the different instances. These keys are emitted by the providers (i.e. Scaleway and AWS)")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installation","aria-hidden":"true"}},[this._v("#")]),this._v(" Installation")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"clone-the-github-repository"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#clone-the-github-repository","aria-hidden":"true"}},[this._v("#")]),this._v(" Clone the Github repository")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("git")]),this._v(" clone https://github.com/kalisio/kaabah.git\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("cd")]),this._v(" kaabah\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"setup-your-terraform-environment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup-your-terraform-environment","aria-hidden":"true"}},[this._v("#")]),this._v(" Setup your Terraform environment")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("Define your Scaleway credentials")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$export")]),t._v(" TF_VAR_SCALEWAY_ACCESS_KEY"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<ACCESS-KEY>"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$export")]),t._v(" TF_VAR_SCALEWAY_TOKEN"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<ACCESS-TOKEN>"')]),t._v(" \n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("Define your AWS credentials")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$export")]),t._v(" TF_VAR_AWS_ACCESS_KEY"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<ACCESS-KEY>"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$export")]),t._v(" TF_VAR_AWS_SECRET_KEY"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<SECRET-KEY>"')]),t._v(" \n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create a file "),e("code",[this._v("backend.config")]),this._v(" with the following properties:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('bucket = "the name of the bucket"\nregion = "the region of the bucket"\nkey    = "the key to the states"\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"5"}},[e("li",[this._v("Initialize Terraform")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$terraform")]),this._v(" init -backend-config"),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[this._v('"path/to/your/backend.config"')]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usage","aria-hidden":"true"}},[this._v("#")]),this._v(" Usage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Please take care your DNS is correctly configured. A "),e("strong",[this._v("A Record")]),this._v(" should map your domain to the Swarm manager IP address.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"create-a-workspace"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-a-workspace","aria-hidden":"true"}},[this._v("#")]),this._v(" Create a workspace")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$terraform")]),this._v(" workspace new demo-dev\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Terraform will automatically switch to the created workspace "),e("code",[this._v("demo-dev")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"configure-the-workspace"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-workspace","aria-hidden":"true"}},[this._v("#")]),this._v(" Configure the workspace")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("We recommend to create a "),e("code",[this._v("tfvars")]),this._v(" file to override the default variables for your workspace. For instance, the "),e("code",[this._v("demo-dev.tfvars")]),this._v(" file may look like this:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('provider = "AWS"\n\nssh_key = "workspaces/key.pem" # the path to the private key\n\nmanager_ip = "3.120.200.41"\n\nmanager_instance_type = "t2.small"\n\nmanager_user_script = "workspaces/test-script.sh"\n\nworker_instance_type = "t3.large"\n\nworker_instance_count = 3\n\nworker_additional_volume_count = 1\n\nworker_additional_volume_size = 1000\n\nworker_additional_volume_type = "io1"\n\nworker_labels=["worker0=true apps=true", "worker1=true", "worker2=true dbs=true"]\n\nworker_user_scripts=["workspaces/test-script.sh", "workspaces/test-script.sh", "workspaces/test-script.sh"]\n\nca_server = "https://acme-staging-v02.api.letsencrypt.org/directory"\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"apply-the-changes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apply-the-changes","aria-hidden":"true"}},[this._v("#")]),this._v(" Apply the changes")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$terraform")]),this._v(" apply -var-file"),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[this._v('"path/to/your/config.tfvars"')]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"check-the-infrastructure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#check-the-infrastructure","aria-hidden":"true"}},[this._v("#")]),this._v(" Check the infrastructure")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Get connected to the manager of your infrastructure using "),e("code",[this._v("ssh")]),this._v(" and type the following commands:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$docker")]),this._v(" node "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("ls")]),this._v("\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\nrwwms640br7eworemnzm71kas *   app-dev-manager    Ready               Active              Leader              18.03.1-ce\ncncd3bj11drznaih0zgsxoi2y     app-dev-worker-1   Ready               Active                                  18.03.1-ce\n4fup9ac9pklv5h81v0o99w40h     app-dev-worker-2   Ready               Active                                  18.03.1-ce\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nID                  NAME                         MODE                REPLICAS            IMAGE                           PORTS\njwyzwgo2mjyb        services_alertmanager        replicated          1/1                 prom/alertmanager:latest\na35bnom5voa1        services_blackbox-exporter   replicated          1/1                 prom/blackbox-exporter:latest\nsr7c26casj5o        services_cadvisor            global              3/3                 google/cadvisor:latest          *:8081-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("8080/tcp\nyp94tsujdftq        services_grafana             replicated          1/1                 grafana/grafana:latest\njql9o8nawlkm        services_node-exporter       global              3/3                 prom/node-exporter:latest\n0jl7slbb6tll        services_portainer           replicated          1/1                 portainer/portainer:latest\nhgeulxbwkex2        services_prometheus          replicated          1/1                 prom/prometheus:latest\nltstocwymexj        services_traefik             replicated          1/1                 traefik:latest\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"destroy-the-infrastructure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#destroy-the-infrastructure","aria-hidden":"true"}},[this._v("#")]),this._v(" Destroy the infrastructure")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$terraform")]),this._v(" apply -var-file"),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[this._v('"path/to/your/config.tfvars"')]),this._v("\n")])])])}],!1,null,null,null);e.default=s.exports}}]);