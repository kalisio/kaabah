<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kaabah</title>
    <meta name="description" content="A Terraform solution to build and operate Docker Swarm infrastructures">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-icon-64x64.png">
  <link rel="manifest" href="/kaabah/manifest.json">
    
    <link rel="preload" href="/kaabah/assets/css/0.styles.8280e1ab.css" as="style"><link rel="preload" href="/kaabah/assets/js/app.be8c1d95.js" as="script"><link rel="preload" href="/kaabah/assets/js/7.f5376f50.js" as="script"><link rel="prefetch" href="/kaabah/assets/js/2.e69eec40.js"><link rel="prefetch" href="/kaabah/assets/js/3.702158b9.js"><link rel="prefetch" href="/kaabah/assets/js/4.8eecaaf7.js"><link rel="prefetch" href="/kaabah/assets/js/5.1ea87e1e.js"><link rel="prefetch" href="/kaabah/assets/js/6.4c71ed54.js"><link rel="prefetch" href="/kaabah/assets/js/8.3b04fe92.js"><link rel="prefetch" href="/kaabah/assets/js/9.909954aa.js"><link rel="prefetch" href="/kaabah/assets/js/10.bcc209c7.js">
    <link rel="stylesheet" href="/kaabah/assets/css/0.styles.8280e1ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kaabah/" class="home-link router-link-active"><!----> <span class="site-name">Kaabah</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kaabah/what-is-it/" class="nav-link">What is it ?</a></div><div class="nav-item"><a href="/kaabah/how-does-it-work/" class="nav-link router-link-exact-active router-link-active">How doest it work ?</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">How to use it ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/getting-started.html" class="nav-link">Getting started</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/tips.html" class="nav-link">Tips</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">   ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/kaabah/CONTRIBUTING.html" class="nav-link">Contributing</a></li><li class="dropdown-item"><!----> <a href="/kaabah/LICENSE.html" class="nav-link">License</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kaabah/what-is-it/" class="nav-link">What is it ?</a></div><div class="nav-item"><a href="/kaabah/how-does-it-work/" class="nav-link router-link-exact-active router-link-active">How doest it work ?</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">How to use it ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/getting-started.html" class="nav-link">Getting started</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/tips.html" class="nav-link">Tips</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">   ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/kaabah/CONTRIBUTING.html" class="nav-link">Contributing</a></li><li class="dropdown-item"><!----> <a href="/kaabah/LICENSE.html" class="nav-link">License</a></li></ul></div></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <i><small>Unleashing the potential of spatial information</small></i></p> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kaabah/how-does-it-work/#main-concepts" class="sidebar-link">Main concepts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/how-does-it-work/#global-approach" class="sidebar-link">Global approach</a></li></ul></li><li><a href="/kaabah/how-does-it-work/#terraform" class="sidebar-link">Terraform</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/kaabah/how-does-it-work/#docker-swarm" class="sidebar-link">Docker Swarm</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/kaabah/how-does-it-work/#traefik" class="sidebar-link">Traefik</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p>::: Prerequisites
<strong>Kaabah</strong> relies on various technologies such as <a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">Docker Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://portainer.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>... and we assume that you are enough familiar with them. If not, please take a while to discover them.
:::</p> <h2 id="main-concepts"><a href="#main-concepts" aria-hidden="true" class="header-anchor">#</a> Main concepts</h2> <p><strong>Kaabah</strong> let you manipulate the 4 main entities:</p> <ul><li><em>Configuration</em>: a set of Terraform variables used to design your infrastructure: the cloud provider, the number of workers, the number of volumes...</li> <li><em>Workspace</em>: a collection of everything Terraform needs to manager an infrastructure: the configuration and state data to keep track of operations.</li> <li><em>Cluster</em>: a Docker Swarm infrastructure built using *<em>Kaabah</em>. Such an infrastructure is composed a manager node and a set of worker nodes. By default, <strong>Kaabah</strong> will protect your cluster with TLS certificates.</li> <li><em>Service</em>: an application deployed on your <strong>Cluster</strong>. By default, <strong>Kaabah</strong> comes with the following services:
<ul><li><a href="https://docs.docker.com/registry/" target="_blank" rel="noopener noreferrer">Registry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://traefik.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://portainer.io/" target="_blank" rel="noopener noreferrer">Portainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h3 id="global-approach"><a href="#global-approach" aria-hidden="true" class="header-anchor">#</a> Global approach</h3> <p><strong>Kaabah</strong> is designed to take advantage of Terraform Workspaces and its usage relies on the recommend practices as presented in this <a href="https://www.terraform.io/docs/enterprise/guides/recommended-practices/part1.html#the-recommended-terraform-workspace-structure" target="_blank" rel="noopener noreferrer">article<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Thus, we assume a workspace is used to store the configuration of your infrastructure for each environment.</p> <p>Starting from this premise, <strong>Kaabah</strong> lets you to manage as many clusters as your projects require. If we decide to name our workspaces with both the project name and its environment (i.e. dev, test...), we can sketch the following diagram to illustrate the overall functioning of <strong>Kaabah</strong>:</p> <p><img src="/kaabah/assets/img/kaabah-terraform.555a6e18.svg" alt="Kaabah terraform"></p> <p>In this diagram, the states of the different workspaces are stored within a dedicated bucket on amazon S3, but you are free to use any other Terraform <a href="https://www.terraform.io/docs/backends/" target="_blank" rel="noopener noreferrer">backends<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="terraform"><a href="#terraform" aria-hidden="true" class="header-anchor">#</a> Terraform</h2> <p>The Terraform code is composed of 2 modules:</p> <ul><li>the <strong>AWS</strong> module which implements the Docker Swarm infrastructure on AWS</li> <li>the <strong>Scaleway</strong> module which implements the Docker Swarm infrastructure on Scaleway</li></ul> <p>And it exposes the following variables:</p> <table><thead><tr><th>Variables</th> <th>Description</th></tr></thead> <tbody><tr><td><code>SCALEWAY_ACCESS_KEY</code></td> <td>Your Scaleway access key</td></tr> <tr><td><code>SCALEWAY_TOKEN</code></td> <td>Your Scaleway token</td></tr> <tr><td><code>AWS_ACCESS_KEY</code></td> <td>Your AWS access key. This is important to note that your credential must allows access to AWS EC2 and S3 services</td></tr> <tr><td><code>AWS_SECRET_KEY</code></td> <td>Your AWS secret key</td></tr> <tr><td><code>AUTH_USER</code></td> <td>Your authentication identity to access the services</td></tr> <tr><td><code>AUTH_PASSWORD</code></td> <td>Your authentication password to access the services. It must be encrypted and for now only <b>SHA1</b> encryption is supported</td></tr> <tr><td><code>provider</code></td> <td>The provider to host the infrastructure. It must be <code>AWS</code> or <code>Scaleway</code>. There is no default value</td></tr> <tr><td><code>domain</code></td> <td>The domain to be added to the traefik rules. The default value is <code>kalisio.xyz</code></td></tr> <tr><td><code>subdomain</code></td> <td>The subdomain to be added to the traefik rules. By default, the value will be computed from the Terraform workspace name by replacing each <code>-</code> by <code>.</code>. For instance, the subdomain for the workspace <code>app-dev</code> will be <code>app.dev</code></td></tr> <tr><td><code>ca_server</code></td> <td>The Let's Encrypt server to generate certificates. The default value is empty to let traefik manage for you. However and because Let's Encrypt provides <a href="https://letsencrypt.org/docs/rate-limits/" target="_blank" rel="noopener noreferrer">rate limits<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> it is recommended to set this value to <code>https://acme-staging-v02.api.letsencrypt.org/directory</code> when testing your infrastructure.</td></tr> <tr><td><code>contact</code></td> <td>The email contact provided to Let's Encrypt when generating certificates. The default value is <code>contact@kalisio.com</code></td></tr> <tr><td><code>docker_version</code></td> <td>The version of the Docker engine to be installed. The default value is <code>18.03.1~ce-0~ubuntu</code></td></tr> <tr><td><code>docker_network</code></td> <td>The name of the Docker network to be created. The default value is the name of the Terraform workspace without the environment part. For instance, the Docker network for the workspace <code>app-dev</code> will be <code>app</code></td></tr> <tr><td><code>manager_instance_type</code></td> <td>The instance type of the Docker Swarm manager. It must be a X86 64bits architecture and it depends on the provider. There is no default value</td></tr> <tr><td><code>worker_instance_type</code></td> <td>The instance type of the Docker Swarm workers. It must be a X86 64bits architecture and it depends on the provider. There is no default value</td></tr> <tr><td><code>worker_instance_count</code></td> <td>The number of worker instances. The default value is <code>1</code></td></tr> <tr><td><code>worker_additional_volume_count</code></td> <td>The number of volumes attached to each worker. The default value is <code>0</code></td></tr> <tr><td><code>worker_additional_volume_size</code></td> <td>The size in giga bytes of the additional volumes. Note that on Scaleway you are limited to 150GB and the minimum size is 50GB. Moreover, you can add volumes to baremetal instances only. The default value is <code>150</code></td></tr> <tr><td><code>worker_additional_volume_type</code></td> <td>The type of additional volumes to add. This option only works on AWS. The different <a href="https://docs.aws.amazon.com/fr_fr/AWSEC2/latest/UserGuide/EBSVolumeTypes.html" target="_blank" rel="noopener noreferrer">types<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> are <code>gp2</code>, <code>io1</code>, <code>st1</code> and <code>sc1</code>. The default value is <code>sc1</code></td></tr> <tr><td><code>ssh_key</code></td> <td>The path to the the ssh key required to get connected to the instances. The default value is <code>ssh.pem</code></td></tr> <tr><td><code>key_name</code></td> <td>The AWS name of the ssh key to be used when creating the instance. The default value is <code>kalisio</code></td></tr></tbody></table> <p>These variables can be overridden to match your environment requirements. See the section <a href="/kaabah/how-to-use-it/getting-started.html">How to use it ?</a></p> <h2 id="docker-swarm"><a href="#docker-swarm" aria-hidden="true" class="header-anchor">#</a> Docker Swarm</h2> <p><b>Kaabah</b> provides the Terraform and Docker configuration to create and manage a Docker Swarm with a stack of high level services that allows you to:</p> <ul><li>route the traffic to the cluster and ensure SSL termination using <a href="https://traefik.io/" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>manage the services deployed on the cluster using <a href="https://portainer.io/" target="_blank" rel="noopener noreferrer">Portainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>monitor the cluster using <a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>analyze the cluster metrics using <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>share files among the nodes of the cluster using <a href="https://fr.wikipedia.org/wiki/Secure_shell_file_system" target="_blank" rel="noopener noreferrer">SSHFS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>The following diagram illustrates a Swarm cluster composed of 4 nodes including a <b>manager</b> and 3 <b>workers</b> and the corresponding stack of services.</p> <p><img src="/kaabah/assets/img/kaabah-swarm.d67d6932.svg" alt="swarm concept"></p> <p>The instances are named according the following convention:</p> <ul><li><code>&lt;WORKSPACE&gt;-manager</code></li> <li><code>&lt;WORKSPACE&gt;-woker-&lt;INDEX&gt;</code></li></ul> <h2 id="traefik"><a href="#traefik" aria-hidden="true" class="header-anchor">#</a> Traefik</h2> <p><b>traefik</b> allows to route the traffic from internet to the Docker Swarm infrastructure with SSL termination. It uses <a href="https://letsencrypt.org/" target="_blank" rel="noopener noreferrer">Let's Encrypt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to generate and renew SSL certificates for each services.</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>Du to rate limits fixed by Let's Encrypt, it is highly recommend to set the <code>ca_server</code> variable to <code>https://acme-staging-v02.api.letsencrypt.org/directory</code> when testing your infrastructure.</p></div> <p>By default, <b>Kaabah</b> specializes the <b>traefik</b> configuration with:</p> <ul><li>2 entrypoints:
<ul><li>to allow HTTPS requests</li> <li>to allow and redirect HTTP request to HTTPS</li></ul></li> <li>5 frontends to access the services:
<ul><li><strong>traefik (dashboard)</strong></li> <li><strong>Portainer</strong></li> <li><strong>Prometheus</strong></li> <li><strong>Alertmanager</strong></li> <li><strong>Grafana</strong></li></ul></li></ul> <p>The frontend rules depend on the <code>subdomain</code> and <code>donain</code> variables defined in the Terraform configuration.</p> <p>It also support basic authentication to access the services using the variables <code>AUTH_USER</code> and <code>AUTH_PASSWORD</code>. This means that <strong>portainer</strong> and <strong>grafana</strong> authentication have been disabled.</p> <p>Considering a Terraform workspace named <code>app-dev</code>, the default subdomain will be <code>app.dev</code>and the <strong>traefik</strong> configuration will be as the following diagram:</p> <p><img src="/kaabah/assets/img/kaabah-traefik.96292850.svg" alt="traefik routing"></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/kaabah/assets/js/7.f5376f50.js" defer></script><script src="/kaabah/assets/js/app.be8c1d95.js" defer></script>
  </body>
</html>
