(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{179:function(a,t,e){"use strict";e.r(t);var s=e(0),r=Object(s.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"advanced-usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#advanced-usage","aria-hidden":"true"}},[a._v("#")]),a._v(" Advanced usage")]),a._v(" "),e("h2",{attrs:{id:"docker-swarm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm","aria-hidden":"true"}},[a._v("#")]),a._v(" Docker swarm")]),a._v(" "),e("h3",{attrs:{id:"managing-labels"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#managing-labels","aria-hidden":"true"}},[a._v("#")]),a._v(" Managing labels")]),a._v(" "),e("p",[a._v("If you desire to update the labels on your cluster and keep track of the changes, you need to:")]),a._v(" "),e("ol",[e("li",[a._v("taint the resources attached to the labels you want to change: "),e("code",[a._v("null_resource.manager_labels")]),a._v(" and "),e("code",[a._v("null_resource.worker_labels.*")])])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Taint the labels attached to the desired nodes, i.e. the worker 1 and the manager")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$terraform")]),a._v(" taint -module"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("AWS null_resource.worker_labels.1\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$terraform")]),a._v(" taint -module"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("AWS null_resource.manager_labels\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[a._v("update your variables file: "),e("code",[a._v("workspaces/<file>.tfvars")])])]),a._v(" "),e("li",[e("p",[a._v("apply the changes")])])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$terraform")]),a._v(" apply -var-file"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"workspaces/<file>.tfvars"')]),a._v("\n")])])]),e("h3",{attrs:{id:"using-the-registry"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#using-the-registry","aria-hidden":"true"}},[a._v("#")]),a._v(" Using the registry")]),a._v(" "),e("p",[a._v("Using the registry is simple as:")]),a._v(" "),e("ol",[e("li",[a._v("build or pull the desired Docker image")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Build example")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$docker")]),a._v(" build https://github.com/"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("organisation"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("repository"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(".git -t "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[a._v("tag the image")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$docker")]),a._v(" tag "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 127.0.0.1:5000/"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(":"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("tag"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[a._v("push the image into the registry")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$docker")]),a._v(" push 127.0.0.1:5000/"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(":"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("tag"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[a._v("create or deploy a service using the image in the registry")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# create a service")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$docker")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" create --replicas 4 --name "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("service"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 127.0.0.4:5000/"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(":"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("tag"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),e("p",[a._v("or")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# deploy the service within a stack:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$docker")]),a._v(" stack deploy -c "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("service.yml"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" -c "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("other-service.yml"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("stack"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),e("p",[a._v("where "),e("code",[a._v("<service.yml>")]),a._v(" is a "),e("strong",[a._v("Docker Compose file")]),a._v(" with the following skeleton:")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3.5'")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("<service>")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 127.0.0.1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("5000/<image"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("<tag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" kaabah"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("network\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("deploy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("replicas")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" <replicas"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kargo-network")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("DOCKER_NETWORK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("external")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n")])])]),e("h2",{attrs:{id:"services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#services","aria-hidden":"true"}},[a._v("#")]),a._v(" Services")]),a._v(" "),e("h3",{attrs:{id:"updating-the-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#updating-the-services","aria-hidden":"true"}},[a._v("#")]),a._v(" Updating the services")]),a._v(" "),e("p",[a._v("When updating Kaabah, you may need to update the services running on a given infrastructure. You can rely on Terraform to proceed:")]),a._v(" "),e("ol",[e("li",[a._v("taint the resource assigned to the services, that is to say: "),e("code",[a._v("null_resource.services")])])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$terraform")]),a._v(" taint -module"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("AWS null_resource.services\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[a._v("apply to update the services")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$terraform")]),a._v(" apply -var-file"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"workspaces/<file>.tfvars"')]),a._v("\n")])])]),e("h3",{attrs:{id:"extending-the-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extending-the-services","aria-hidden":"true"}},[a._v("#")]),a._v(" Extending the services")]),a._v(" "),e("p",[e("strong",[a._v("Kaabah")]),a._v(" allows you to extend the default services for a given cluster. For this, you must use the "),e("code",[a._v("extensions_dir")]),a._v(" variable and let it to point to an existing directory that includes:")]),a._v(" "),e("ul",[e("li",[a._v("a "),e("code",[a._v("deploy")]),a._v(" directory where to put the "),e("strong",[a._v("Docker Compose files")]),a._v(" to be used to deploy the services")]),a._v(" "),e("li",[a._v("a "),e("code",[a._v("configs")]),a._v(" directory to be used to store the configuration of the services")])]),a._v(" "),e("p",[a._v("You can take advantage of this feature to:")]),a._v(" "),e("ul",[e("li",[a._v("extend the configuration of an existing service, i.e. add some limits to the container's resources")]),a._v(" "),e("li",[a._v("override the default configuration of the existing services")]),a._v(" "),e("li",[a._v("bootstrap your cluster with additional services")])])])}],!1,null,null,null);t.default=r.exports}}]);