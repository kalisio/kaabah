<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Understanding Kaabah | Kaabah</title>
    <meta name="description" content="A Terraform solution to build and operate Docker Swarm infrastructures">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kaabah/kaabah-icon-64x64.png">
  <link rel="manifest" href="/kaabah/manifest.json">
    
    <link rel="preload" href="/kaabah/assets/css/0.styles.5f60cd56.css" as="style"><link rel="preload" href="/kaabah/assets/js/app.1e313884.js" as="script"><link rel="preload" href="/kaabah/assets/js/2.1abc3132.js" as="script"><link rel="prefetch" href="/kaabah/assets/js/10.190adff0.js"><link rel="prefetch" href="/kaabah/assets/js/11.f02e67a7.js"><link rel="prefetch" href="/kaabah/assets/js/12.92a6fee4.js"><link rel="prefetch" href="/kaabah/assets/js/13.3905b468.js"><link rel="prefetch" href="/kaabah/assets/js/14.8684b11a.js"><link rel="prefetch" href="/kaabah/assets/js/15.202a4118.js"><link rel="prefetch" href="/kaabah/assets/js/3.9de83eee.js"><link rel="prefetch" href="/kaabah/assets/js/4.f802746a.js"><link rel="prefetch" href="/kaabah/assets/js/5.3d04ef56.js"><link rel="prefetch" href="/kaabah/assets/js/6.dd0c15ed.js"><link rel="prefetch" href="/kaabah/assets/js/7.9013544a.js"><link rel="prefetch" href="/kaabah/assets/js/8.d8d35305.js"><link rel="prefetch" href="/kaabah/assets/js/9.ee7bb7cb.js">
    <link rel="stylesheet" href="/kaabah/assets/css/0.styles.5f60cd56.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kaabah/" class="home-link router-link-active"><!----> <span class="site-name">Kaabah</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kaabah/about/introduction.html" class="nav-link">About</a></div><div class="nav-item"><a href="/kaabah/guides/understanding-kaabah.html" class="nav-link router-link-exact-active router-link-active">Guides</a></div><div class="nav-item"><a href="/kaabah/reference/configuration-variables.html" class="nav-link">Reference</a></div><div class="nav-item"><a href="/kaabah/tips/" class="nav-link">Tips</a></div><div class="nav-item"><a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kaabah/about/introduction.html" class="nav-link">About</a></div><div class="nav-item"><a href="/kaabah/guides/understanding-kaabah.html" class="nav-link router-link-exact-active router-link-active">Guides</a></div><div class="nav-item"><a href="/kaabah/reference/configuration-variables.html" class="nav-link">Reference</a></div><div class="nav-item"><a href="/kaabah/tips/" class="nav-link">Tips</a></div><div class="nav-item"><a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <i><small>Unleashing the potential of spatial information</small></i></p> <ul class="sidebar-links"><li><a href="/kaabah/guides/understanding-kaabah.html" class="active sidebar-link">Understanding Kaabah</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#key-concepts" class="sidebar-link">Key concepts</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#workspace" class="sidebar-link">Workspace</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#cluster" class="sidebar-link">Cluster</a></li><li class="sidebar-sub-header"><a href="/kaabah/guides/understanding-kaabah.html#services" class="sidebar-link">Services</a></li></ul></li><li><a href="/kaabah/guides/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/kaabah/guides/advanced-usage.html" class="sidebar-link">Advanced usage</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="understanding-kaabah"><a href="#understanding-kaabah" aria-hidden="true" class="header-anchor">#</a> Understanding Kaabah</h1> <div class="warning custom-block"><p class="custom-block-title">Prerequisites</p> <p><strong>Kaabah</strong> relies on various technologies such as <a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">Docker Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://portainer.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>... and we assume that you are enough familiar with them. If not, please take a while to discover them.</p></div> <h2 id="key-concepts"><a href="#key-concepts" aria-hidden="true" class="header-anchor">#</a> Key concepts</h2> <p><strong>Kaabah</strong> let you manipulate 4 kind of entities:</p> <ul><li><strong>Workspace</strong>: a collection of everything <strong>Kaabah</strong> needs to create and manage an infrastructure.</li> <li><strong>Configuration</strong>: a set of Terraform variables used to design your infrastructure.</li> <li><strong>Cluster</strong>: a <a href="https://docs.docker.com/engine/swarm/key-concepts/" target="_blank" rel="noopener noreferrer">Docker Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> built using <strong>Kaabah</strong>.</li> <li><strong>Service</strong>: an application deployed on your <strong>Cluster</strong>. By default, <strong>Kaabah</strong> comes with the following services which helps operating the <strong>Cluster</strong>:
<ul><li><a href="https://traefik.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://portainer.io" target="_blank" rel="noopener noreferrer">Portainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://prometheus.io" target="_blank" rel="noopener noreferrer">Prometheus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://grafana.com" target="_blank" rel="noopener noreferrer">Grafana<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/registry" target="_blank" rel="noopener noreferrer">Registry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <p>The following image illustrates how these entities interact:</p> <p><img src="/kaabah/assets/img/kaabah-principle.9287b283.svg" alt="Kaabah principle"></p> <p>In addition provides a set of commands that help you to operate the cluster. For instance, you can easily prune all the images on the different nodes, execute a command on a given node... See the <a href="../reference/helper-commands">reference</a> page to have the complete list.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>The helper commands are installed in <code>/usr/local/sbin</code> and can be used out of the box.</p></div> <h2 id="workspace"><a href="#workspace" aria-hidden="true" class="header-anchor">#</a> Workspace</h2> <p><strong>Kaabah</strong> is designed to take advantage of Terraform Workspaces. Indeed, <strong>Kaabah</strong> relies on the <a href="https://www.terraform.io/docs/enterprise/guides/recommended-practices/part1.html#the-recommended-terraform-workspace-structure" target="_blank" rel="noopener noreferrer">Terraform recommend practices<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and assume a <strong>Workspace</strong> is used to store the required data needed to build and manage an infrastructure for a specific environment (staging, production...):</p> <ul><li>the configuration of the infrastructure.</li> <li>the SSH private key to get connected to the infrastructure</li> <li>the extensions to the services you want to be installed by <strong>Kaabah</strong></li> <li>the user scripts you want to be executed when creating the infrastructure</li> <li>the SSH private key to get connected to the infrastructure</li> <li>the Terraform states of the infrastructure.</li></ul> <p>Starting from this premise, <strong>Kaabah</strong> lets you to manage as many clusters as your projects require. If we decide to name our workspaces with both the project name and its environment (i.e. dev, test...), we can sketch the following diagram to illustrate the overall functioning of <strong>Kaabah</strong>:</p> <p><img src="/kaabah/assets/img/kaabah-terraform.555a6e18.svg" alt="Kaabah terraform"></p> <p>In this diagram, the states of the different workspaces are stored within a dedicated bucket on amazon S3, but you are free to use any other Terraform <a href="https://www.terraform.io/docs/backends/" target="_blank" rel="noopener noreferrer">backends<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2> <p>The <strong>Kaabah</strong> configuration file is a <strong>Terraform</strong> variable file describing the characteristics of the desired infrastructure.</p> <p>Here is an example of a configuration file:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token constant">provider</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;AWS&quot;</span>

<span class="token constant">manager_ip</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;3.115.176.41&quot;</span>

<span class="token constant">manager_instance_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;t2.small&quot;</span>

<span class="token constant">worker_instance_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;t3.large&quot;</span>

<span class="token constant">worker_instance_count</span> <span class="token attr-value"><span class="token punctuation">=</span> 3</span>

<span class="token constant">worker_additional_volume_count</span> <span class="token attr-value"><span class="token punctuation">=</span> 2</span>

<span class="token constant">worker_additional_volume_size</span> <span class="token attr-value"><span class="token punctuation">=</span> 500</span>

<span class="token constant">worker_additional_volume_type</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;st1&quot;</span>

<span class="token constant">worker_additional_volume_mount_point</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;DATA&quot;</span>

</code></pre></div><p>Assuming the current workspace is <code>app-dev</code>, then when applying such a configuration, <strong>Kaabah</strong> will generate a Docker Swarm infrastructure on <code>AWS</code> (<code>provider</code> variable) composed of:</p> <ul><li>one manager node, <code>app-dev-manager</code>, of type <code>t2.small</code> with the public IP address <code>3.115.176.41</code>.</li> <li><code>3</code> worker nodes, <code>app-dev-worker-0</code>, <code>app-dev-worker-1</code> and <code>app-dev-worker-2</code>, of type of <code>t3.large</code>. To each worker is attached <code>2</code> optimized hard-disk (<code>sc1</code>) of <code>500</code>GB and these volumes are accessible through the mount points: <code>/mnt/DATA0</code> and <code>/mnt/DATA1</code>.</li></ul> <p><strong>Kaabah</strong> exposes many more variables allowing you to customize in detail your infrastructure such as specifying a domain name, adding labels, running user scripts... Have a look at the complete list of <a href="/kaabah/reference/configuration-variables.html">variables</a> and the <a href="https://github.com/kalisio/kaabah/tree/master/tests" target="_blank" rel="noopener noreferrer">tests<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as an example.</p> <h2 id="cluster"><a href="#cluster" aria-hidden="true" class="header-anchor">#</a> Cluster</h2> <p>The <strong>cluster</strong> consists in of multiple Docker hosts which run in <strong>swarm</strong> mode and act as manager (to manage membership and delegation) and workers (which run services).</p> <p><img src="/kaabah/assets/img/kaabah-swarm.d67d6932.svg" alt="swarm concept"></p> <h3 id="instances"><a href="#instances" aria-hidden="true" class="header-anchor">#</a> Instances</h3> <p>When generated from a given <code>&lt;WORKSPACE&gt;</code>, the instances are named according the following convention:</p> <ul><li><code>&lt;WORKSPACE&gt;-manager</code></li> <li><code>&lt;WORKSPACE&gt;-woker-&lt;INDEX&gt;</code></li></ul> <p>You can add some labels to the nodes using the <code>manager_labels</code> and <code>worker_labels</code> variables.</p> <h3 id="volumes"><a href="#volumes" aria-hidden="true" class="header-anchor">#</a> Volumes</h3> <p>When needed extra disk spaces, you can attach additional volumes to the workers. These volumes are automatically attached, formatted (ext4 file system) and mounted on the workers. By default the volumes attached on a worker are accessible with the paths <code>/mnt/data0</code>, <code>mnt/data1</code> and so on. You can override the default <code>data</code> mount point by overriding the <code>worker_additional_volume_mount_point</code> variable.</p> <h3 id="security-groups"><a href="#security-groups" aria-hidden="true" class="header-anchor">#</a> Security Groups</h3> <p>By default, <strong>Kaabah</strong> creates 2 security groups:</p> <ul><li>the manager security group allowing:
<ul><li>SSH traffic (port 22).</li> <li>HTTP traffic (port 80).</li> <li>HTTPS traffic (port 443).</li> <li>Docker swarm traffic. The traffic is limited to your private network.</li></ul></li> <li>the workers security group with the following rules:
<ul><li>SSH traffic (port 22)</li> <li>Docker swarm traffic. The traffic is limited to your private network.</li></ul></li></ul> <h3 id="docker-network"><a href="#docker-network" aria-hidden="true" class="header-anchor">#</a> Docker network</h3> <p>The traffic between the nodes is relying on a Docker network of type of <strong>Overlay</strong>.</p> <p>The name of the Docker network is automatically computed from the workspace name but you can override it using the <code>docker_network</code> variable.</p> <h3 id="security"><a href="#security" aria-hidden="true" class="header-anchor">#</a> Security</h3> <p>In Swarm mode, the nodes communicate using an HTTP socket and therefore it is highly recommended to protect the the Docker daemon. <strong>Kaabah</strong> will do it for you ! Therefore the Docker daemon only allows connections from clients authenticated by a certificate signed by a Certificate Authority (CA).</p> <p>When creating the cluster, <strong>Kaabah</strong> handles the creation of the server and client keys but it requires you to provide this CA. Check out the <a href="/kaabah/guides/getting-started.html">Getting started section</a> to learn how to generate this CA.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p><strong>Kaabah</strong> relies on <a href="https://www.openssl.org/" target="_blank" rel="noopener noreferrer">OpenSSL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to generate the server and client keys.</p></div> <h2 id="services"><a href="#services" aria-hidden="true" class="header-anchor">#</a> Services</h2> <p>As mentioned in the introduction, <strong>Kaabah</strong> bootstraps a cluster with a stack of high level services that allows you to:</p> <ul><li>route the traffic to the cluster and ensure SSL termination using <a href="https://traefik.io/" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>manage the services deployed on the cluster using <a href="https://portainer.io/" target="_blank" rel="noopener noreferrer">Portainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>monitor the cluster using <a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>analyze the cluster metrics using <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>The access to the UI of the different services is protected using Basic Authentication.</p></div> <p>In addition, <strong>Kaabah</strong> lets you extend this stack to add the services of your choice. See the <a href="/kaabah/guides/advanced-usage.html#extending-the-services">Extending the services</a> section to learn how to do it.</p> <h3 id="traefik"><a href="#traefik" aria-hidden="true" class="header-anchor">#</a> <a href="https://traefik.io" target="_blank" rel="noopener noreferrer">Traefik<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p><strong>traefik</strong> allows to route the traffic from internet to the Docker Swarm infrastructure with SSL termination. It uses <a href="https://letsencrypt.org/" target="_blank" rel="noopener noreferrer">Let's Encrypt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to generate and renew SSL certificates for each services.</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>Du to rate limits fixed by Let's Encrypt, it is highly recommend to set the <code>ca_server</code> variable to <code>https://acme-staging-v02.api.letsencrypt.org/directory</code> when testing your infrastructure.</p></div> <p>By default, <strong>Kaabah</strong> specializes the <strong>traefik</strong> configuration with:</p> <ul><li>2 entrypoints:
<ul><li>to allow HTTPS requests (port 443)</li> <li>to redirect HTTP (port 80) request to HTTPS (port 443)</li></ul></li> <li>5 frontends to access the services:
<ul><li><strong>traefik (dashboard)</strong></li> <li><strong>Portainer</strong></li> <li><strong>Prometheus</strong></li> <li><strong>Alertmanager</strong></li> <li><strong>Grafana</strong></li></ul></li></ul> <p>The frontend rules depend on the <code>subdomain</code> and <code>donain</code> variables defined in the Terraform configuration. Considering a workspace named <code>app-dev</code>, the default subdomain will be <code>app.dev</code>and the <strong>traefik</strong> configuration will be as shown in the following diagram:</p> <p><img src="/kaabah/assets/img/kaabah-traefik.96292850.svg" alt="traefik routing"></p> <h3 id="portainer"><a href="#portainer" aria-hidden="true" class="header-anchor">#</a> <a href="https://portainer.io" target="_blank" rel="noopener noreferrer">Portainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>There is not too much to say on <strong>Portainer</strong>. Just play with the UI !</p> <h3 id="prometheus"><a href="#prometheus" aria-hidden="true" class="header-anchor">#</a> <a href="https://prometheus.io" target="_blank" rel="noopener noreferrer">Prometheus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>The <strong>Prometheus</strong> monitoring solution is shipped with the following components:</p> <ul><li><a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noopener noreferrer">node-exporter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://github.com/google/cadvisor" target="_blank" rel="noopener noreferrer">cAdvisor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which collect, respectively, the metrics of the cluster's hosts and the services deployed on the Docker swarm.</li> <li><a href="https://prometheus.io/docs/alerting/alertmanager/" target="_blank" rel="noopener noreferrer">Alertmanager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which handles the alerts.</li></ul> <h3 id="grafana"><a href="#grafana" aria-hidden="true" class="header-anchor">#</a> <a href="https://grafana.com" target="_blank" rel="noopener noreferrer">Grafana<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p><strong>Grafana</strong> allows you to visualize the metrics stored in the <strong>Prometheus</strong> databases through dedicated dashboards.</p> <p>By default, <strong>Grafana</strong> includes the following customizations:</p> <ul><li>UI:
<ul><li>Login form disabled: indeed the access to <strong>Grafana</strong> requires to be authenticated (basic auth). This requirement is defined using Traefik frontend rule.</li> <li>Once authenticated, the default user is granted the <code>EDITOR</code> permissions.</li></ul></li> <li>Datasources: the Prometheus datasource is included by default.</li> <li>Dashboards: 2 dashboards are provided by default:
<ul><li>Cluster overview which allow to visualize the main metrics of the cluster nodes</li> <li>Swarm overview which allow to visualize the main metrics of the Docker swarm</li></ul></li></ul> <h3 id="registry"><a href="#registry" aria-hidden="true" class="header-anchor">#</a> <a href="https://docs.docker.com/registry" target="_blank" rel="noopener noreferrer">Registry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>The <strong>Registry</strong> helps you build local images on your cluster and deploy them as a service.</p> <p>Read the <a href="/kaabah/guides/advanced-usage.html#using-the-registry">Using the Registry</a> section.</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/kaabah/guides/getting-started.html">
          Getting started
        </a>
        â†’
      </span></p></div> </div> <!----></div></div>
    <script src="/kaabah/assets/js/app.1e313884.js" defer></script><script src="/kaabah/assets/js/2.1abc3132.js" defer></script>
  </body>
</html>
