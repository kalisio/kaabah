<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting started | Kaabah</title>
    <meta name="description" content="A Terraform solution to build and operate Docker Swarm infrastructures">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-icon-64x64.png">
  <link rel="manifest" href="/kaabah/manifest.json">
    
    <link rel="preload" href="/kaabah/assets/css/0.styles.8280e1ab.css" as="style"><link rel="preload" href="/kaabah/assets/js/app.17acf862.js" as="script"><link rel="preload" href="/kaabah/assets/js/10.ab9d1445.js" as="script"><link rel="prefetch" href="/kaabah/assets/js/3.5b658cdb.js"><link rel="prefetch" href="/kaabah/assets/js/2.ef81631e.js"><link rel="prefetch" href="/kaabah/assets/js/4.03ff8b2f.js"><link rel="prefetch" href="/kaabah/assets/js/5.e66b8c53.js"><link rel="prefetch" href="/kaabah/assets/js/6.18e9f71f.js"><link rel="prefetch" href="/kaabah/assets/js/7.cc881cf6.js"><link rel="prefetch" href="/kaabah/assets/js/8.57af3f82.js"><link rel="prefetch" href="/kaabah/assets/js/9.44501944.js"><link rel="prefetch" href="/kaabah/assets/js/11.2e16e7b2.js"><link rel="prefetch" href="/kaabah/assets/js/12.67f80405.js"><link rel="prefetch" href="/kaabah/assets/js/13.ea2ed627.js">
    <link rel="stylesheet" href="/kaabah/assets/css/0.styles.8280e1ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kaabah/" class="home-link router-link-active"><!----> <span class="site-name">Kaabah</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kaabah/what-is-it/" class="nav-link">What is it ?</a></div><div class="nav-item"><a href="/kaabah/how-does-it-work/" class="nav-link">How doest it work ?</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">How to use it ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/getting-started.html" class="nav-link router-link-exact-active router-link-active">Getting started</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/advanced-usage.html" class="nav-link">Advanced usage</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/configuration-variables.html" class="nav-link">Configuration variables</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/helper-commands.html" class="nav-link">Helper commands</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/tips.html" class="nav-link">Tips</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">   ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/kaabah/CONTRIBUTING.html" class="nav-link">Contributing</a></li><li class="dropdown-item"><!----> <a href="/kaabah/LICENSE.html" class="nav-link">License</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kaabah/what-is-it/" class="nav-link">What is it ?</a></div><div class="nav-item"><a href="/kaabah/how-does-it-work/" class="nav-link">How doest it work ?</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">How to use it ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/getting-started.html" class="nav-link router-link-exact-active router-link-active">Getting started</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/advanced-usage.html" class="nav-link">Advanced usage</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/configuration-variables.html" class="nav-link">Configuration variables</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/helper-commands.html" class="nav-link">Helper commands</a></li><li class="dropdown-item"><!----> <a href="/kaabah/how-to-use-it/tips.html" class="nav-link">Tips</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">   ?</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kalisio/kaabah" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/kaabah/CONTRIBUTING.html" class="nav-link">Contributing</a></li><li class="dropdown-item"><!----> <a href="/kaabah/LICENSE.html" class="nav-link">License</a></li></ul></div></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <i><small>Unleashing the potential of spatial information</small></i></p> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Getting started</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/kaabah/how-to-use-it/getting-started.html#prerequisites" class="sidebar-link">Prerequisites</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/kaabah/how-to-use-it/getting-started.html#installation" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/how-to-use-it/getting-started.html#clone-the-github-repository" class="sidebar-link">Clone the Github repository</a></li><li class="sidebar-sub-header"><a href="/kaabah/how-to-use-it/getting-started.html#setup-your-terraform-environment" class="sidebar-link">Setup your Terraform environment</a></li></ul></li><li><a href="/kaabah/how-to-use-it/getting-started.html#usage" class="sidebar-link">Usage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kaabah/how-to-use-it/getting-started.html#create-a-workspace" class="sidebar-link">Create a workspace</a></li><li class="sidebar-sub-header"><a href="/kaabah/how-to-use-it/getting-started.html#configure-the-workspace" class="sidebar-link">Configure the workspace</a></li><li class="sidebar-sub-header"><a href="/kaabah/how-to-use-it/getting-started.html#apply-the-changes" class="sidebar-link">Apply the changes</a></li><li class="sidebar-sub-header"><a href="/kaabah/how-to-use-it/getting-started.html#check-the-infrastructure" class="sidebar-link">Check the infrastructure</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="getting-started"><a href="#getting-started" aria-hidden="true" class="header-anchor">#</a> Getting started</h1> <h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true" class="header-anchor">#</a> Prerequisites</h2> <div class="tip custom-block"><p class="custom-block-title">Certificate Authority</p> <p><strong>Kaabah</strong> ensures TLS authentication for Docker daemon and requires a Certificate Authority (CA). More precisely, to use <strong>Kaabah</strong>, you need the following files:</p> <ul><li>the CA private key</li> <li>the CA public key</li> <li>the CA passphrase file</li></ul> <p>You can use the following <a href="https://gist.github.com/cnouguier/c5cb4ba99ad45bced4476e2d175342a1" target="_blank" rel="noopener noreferrer">script<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to create the required files.</p></div> <div class="tip custom-block"><p class="custom-block-title">SSH key</p> <p><strong>Kaabah</strong> uses SSH to operate on the various nodes and consequently you need the private key to connect to the different instances. These keys are emitted by the providers (i.e. Scaleway and AWS)</p></div> <div class="tip custom-block"><p class="custom-block-title">AWS S3 Credentials</p> <p>You must have the credentials set to access the desired bucket on AWS S3 otherwise <strong>Terraform</strong> won't initialize.
If needed, follow this <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/setup-credentials.html" target="_blank" rel="noopener noreferrer">guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to set up your credentials.</p></div> <h2 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h2> <h3 id="clone-the-github-repository"><a href="#clone-the-github-repository" aria-hidden="true" class="header-anchor">#</a> Clone the Github repository</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone https://github.com/kalisio/kaabah.git
$ <span class="token function">cd</span> kaabah
</code></pre></div><h3 id="setup-your-terraform-environment"><a href="#setup-your-terraform-environment" aria-hidden="true" class="header-anchor">#</a> Setup your Terraform environment</h3> <ol><li>Define your Scaleway credentials</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$export</span> TF_VAR_SCALEWAY_ACCESS_KEY<span class="token operator">=</span><span class="token string">&quot;&lt;ACCESS-KEY&gt;&quot;</span>
<span class="token variable">$export</span> TF_VAR_SCALEWAY_TOKEN<span class="token operator">=</span><span class="token string">&quot;&lt;ACCESS-TOKEN&gt;&quot;</span> 
</code></pre></div><ol start="2"><li>Define your AWS credentials</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$export</span> TF_VAR_AWS_ACCESS_KEY<span class="token operator">=</span><span class="token string">&quot;&lt;ACCESS-KEY&gt;&quot;</span>
<span class="token variable">$export</span> TF_VAR_AWS_SECRET_KEY<span class="token operator">=</span><span class="token string">&quot;&lt;SECRET-KEY&gt;&quot;</span> 
</code></pre></div><ol start="3"><li>Define your authentication parameters</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$export</span> TF_VAR_KAABAH_AUTH_USER<span class="token operator">=</span><span class="token string">&quot;&lt;AUTH_USER&gt;&quot;</span>
<span class="token variable">$export</span> TF_VAR_KAABAH_AUTH_PASSWORD<span class="token operator">=</span><span class="token string">&quot;&lt;ENCRYPTED_AUTH_PASSWORD&gt;&quot;</span>
</code></pre></div><ol start="4"><li>Define the <a href="https://www.terraform.io/docs/backends/types/s3.html" target="_blank" rel="noopener noreferrer">S3 backend<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> properties</li></ol> <p>Create a file <code>backend.config</code> with the following properties:</p> <div class="language- extra-class"><pre class="language-text"><code>bucket = &quot;the name of the bucket&quot;
region = &quot;the region of the bucket&quot;
key    = &quot;the key to the states&quot;
</code></pre></div><ol start="5"><li>Initialize Terraform</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$terraform</span> init -backend-config<span class="token operator">=</span><span class="token string">&quot;path/to/your/backend.config&quot;</span>
</code></pre></div><h2 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> Usage</h2> <div class="warning custom-block"><p class="custom-block-title">Manager IP address</p> <p><strong>Kaabah</strong> requests the IP address of the Swarm manager to be defined. On <strong>Scaleway</strong> you need to provide a <a href="https://www.scaleway.com/docs/deal-with-private-reserved-ips/#-Create-and-attach-a-reserved-IP-address" target="_blank" rel="noopener noreferrer">Reserved IP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. On <strong>AWS</strong> you need to provide an <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" target="_blank" rel="noopener noreferrer">Elastic IP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <div class="warning custom-block"><p class="custom-block-title">ACME certificates</p> <p>To ensure ACME certificates generation, <strong>traefik</strong> has to be reachable by <strong>Let's Encrypt</strong> through port 80. You can refer to <a href="https://docs.traefik.io/configuration/acme/#httpchallenge" target="_blank" rel="noopener noreferrer">ACME configuration (httpChallenge)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for further information.</p> <p>Please take care your DNS is correctly configured. A <strong>A Record</strong> should map your domain to the Swarm manager IP address.</p></div> <h3 id="create-a-workspace"><a href="#create-a-workspace" aria-hidden="true" class="header-anchor">#</a> Create a workspace</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$terraform</span> workspace new demo-dev
</code></pre></div><p>Terraform will automatically switch to the created workspace <code>demo-dev</code></p> <h3 id="configure-the-workspace"><a href="#configure-the-workspace" aria-hidden="true" class="header-anchor">#</a> Configure the workspace</h3> <p>We recommend to create a <code>tfvars</code> file to override the default variables for your workspace. For instance, the <code>demo-dev.tfvars</code> file may look like this:</p> <div class="language-text extra-class"><pre class="language-text"><code>provider = &quot;AWS&quot;

manager_ip = &quot;3.120.200.41&quot;

manager_instance_type = &quot;t2.small&quot;

manager_user_script = &quot;workspaces/test-script.sh&quot;

worker_instance_type = &quot;t3.large&quot;

worker_instance_count = 3

worker_additional_volume_count = 1

worker_additional_volume_size = 1000

worker_additional_volume_type = &quot;io1&quot;

worker_labels=[&quot;worker0=true apps=true&quot;, &quot;worker1=true&quot;, &quot;worker2=true dbs=true&quot;]

worker_user_scripts=[&quot;workspaces/test-script.sh&quot;, &quot;workspaces/test-script.sh&quot;, &quot;workspaces/test-script.sh&quot;]

ca_server = &quot;https://acme-staging-v02.api.letsencrypt.org/directory&quot;
</code></pre></div><h3 id="apply-the-changes"><a href="#apply-the-changes" aria-hidden="true" class="header-anchor">#</a> Apply the changes</h3> <p>Within your workspace, apply Terraform with your specific configuration:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$terraform</span> apply -var-file<span class="token operator">=</span><span class="token string">&quot;path/to/your/config.tfvars&quot;</span>
</code></pre></div><p>After a while, your cluster should be created and the corresponding Terraform states stored in your S3 backend.</p> <h3 id="check-the-infrastructure"><a href="#check-the-infrastructure" aria-hidden="true" class="header-anchor">#</a> Check the infrastructure</h3> <p>Get connected to the manager of your infrastructure using <code>ssh</code> and type the following commands:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> node <span class="token function">ls</span>
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
rwwms640br7eworemnzm71kas *   app-dev-manager    Ready               Active              Leader              18.03.1-ce
cncd3bj11drznaih0zgsxoi2y     app-dev-worker-1   Ready               Active                                  18.03.1-ce
4fup9ac9pklv5h81v0o99w40h     app-dev-worker-2   Ready               Active                                  18.03.1-ce
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$docker</span> <span class="token function">service</span> <span class="token function">ls</span>
ID                  NAME                         MODE                REPLICAS            IMAGE                           PORTS
jwyzwgo2mjyb        services_alertmanager        replicated          1/1                 prom/alertmanager:latest
a35bnom5voa1        services_blackbox-exporter   replicated          1/1                 prom/blackbox-exporter:latest
sr7c26casj5o        services_cadvisor            global              3/3                 google/cadvisor:latest          *:8081-<span class="token operator">&gt;</span>8080/tcp
yp94tsujdftq        services_grafana             replicated          1/1                 grafana/grafana:latest
jql9o8nawlkm        services_node-exporter       global              3/3                 prom/node-exporter:latest
0jl7slbb6tll        services_portainer           replicated          1/1                 portainer/portainer:latest
hgeulxbwkex2        services_prometheus          replicated          1/1                 prom/prometheus:latest
ltstocwymexj        services_traefik             replicated          1/1                 traefik:latest
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/kaabah/assets/js/10.ab9d1445.js" defer></script><script src="/kaabah/assets/js/app.17acf862.js" defer></script>
  </body>
</html>
